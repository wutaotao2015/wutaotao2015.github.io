---
title: 工具小技巧合集
categories: Tool
tags:
  - Eclipse
  - Sublime Text
  - IntelliJ Idea
  - Maven
  - Vim
  - Babun
  - Git
  - Windows10
  - MacOS
  - Karabiner
  - CORS
  - Shell
  - Ubantu
  - Vmware workstation

abbrlink: 398a782a
updated: 2021-11-18 10:59:51
date: 2019-02-11 14:31:10
---
自己总结的工具小技巧: Eclipse, Sublime Text, IntelliJ Idea, Maven, Vim, Babun, Git,
Windows10,Karabiner
<!-- more -->
## eclipse windows快捷键
下载eclipse安装包应注意选择javaEE版，它里面自带了maven插件。
注：如可以下载eclipse vim插件，以下快捷键设置可以不用看。
```txt
向上 line up     ctrl+k
向下 line down   ctrl+j
左 previous column  ctrl+h
右 next column  ctrl+L<go to line>
alt+j     incremental find
alt+k    find next
智能提示 .abcd....
字体
背景色 general-editors-text editors

Ctrl+a      line start
Ctrl+u    Line end
Ctrl+i     Correct indentation 自动缩进
给本地变量赋值 quick assist assign to local variable    ctrl+2,L改为ctrl+p

ctrl+z  undo the last operation
ctrl+y redo the last operation
全选ctrl+a变为ctrl+shift+a

show in(package explorer)   alt+1
when editing java source

show view console   alt+c
show view package explorer  alt+p

ctrl + backspace 向前删除一个单词
ctrl + delete 向后删除一个单词

分割窗口 在window下选择new window
然后利用windows系统快捷键window+方向键
控制窗口布局

ultraEdit分割窗口
“高级”菜单→配置→应用程序布局→文件标签→操作→取掉勾选“可吸附标签”→应用→确定
再进行鼠标拖动到滚动条附近即可
```
## sublimeText json格式化
安装插件Pretty Json, 格式化json文件快捷键
```txt
windows: ctrl + alt + j 
macOS:   ctrl + command + j
```
## IntelliJ Idea

   1. 将当前编辑区文件在package目录下定位显示出来
   使用插件Scroll From Source,定义快捷键为alt + 2,
   alt + 1是控制Package目录窗口显示开关。

   2. 在idea中使用vim模式可以下载插件IdeaVim,定义模式开关快捷键为F1。 

   ### Idea实现和Eclipse Workspace一样的多项目并列显示效果
   1. 新建一个空白文件夹ideaWorkspace.
   2. 将需要引入的项目代码拷贝到该文件夹下。
   3. 用idea open ideaWorkspace.
   4. 在右侧的Maven Projects视图中点击加号，用ctrl键多选刚才导入的各个项目的pom.xml文件。
   5. 可以点击刷新图标进行依赖更新。
   搞定！

## Maven
银行里有个jar包找不到，我以为是maven仓库里没有，跟银行里的人说了下，他又给了我2个mirror
地址，那么问题来了:
> 怎么在settings.xml里配置多个mirror同时起作用？
> mirrorOf是什么意思？
> repository和mirror的区别是什么？

经过搜索和官方文档，总结如下：
   1. repository是存储多个jar包的仓库，maven默认是去center仓库下载jar包。
   2. mirror是repository的复制镜像，由于网速等其他原因用来替代原始仓库，mirror下的mirrorId指定
了复制的的repository的ID,而mirrorId是唯一的。
   3. 在mirrorOf里可以使用如`*`,`*,!repo1`来控制多个镜像时具体哪一个生效的问题,这里判断的依据
就是repository id,
> When you use the advanced syntax and configure multiple mirrors, keep in mind that 
> their declaration order matters. When Maven looks for a mirror of some repository, it 
> first checks for a mirror whose <mirrorOf> exactly matches the repository identifier. 
> If no direct match is found, Maven picks the first mirror declaration that matches 
> according to the rules above (if any). Hence, you may influence match order by changing 
> the order of the definitions in the settings.xml

就是说它先是寻找最匹配的，再按顺序查找其他匹配的。
> As of Maven 3.x, repositories are searched in the order in which they are declared.
具体实战settings.xml如下
```txt
<mirrors>
  <mirror>  
       <id>alimaven</id>  
       <name>aliyun maven</name>  
       <url>http://maven.aliyun.com/nexus/content/groups/public/</url>  
       <mirrorOf>central</mirrorOf>          
   </mirror>
 </mirrors>
 <profiles>
    <profile>
      <id>nexus private</id>

      <repositories>
       <repository>
         <id>ccb</id>  
         <name>ccb</name>  
         <url>http://xxx.xxx.xxx:1280/nexus/content/groups/public/</url>  
       </repository>
     </repositories>
     <pluginRepositories>
       <pluginRepository>
         <id>ccb</id>  
         <name>ccb</name>  
         <url>http://xxx.xxx.xxx:1280/nexus/content/groups/public/</url>  
       </pluginRepository>
     </pluginRepositories>
   </profile>
 </profiles>
 <activeProfiles>
    <activeProfile>nexus private</activeProfile>
 </activeProfiles>
```
具体优先级为
> 本地local .m2/repository > 私服profile > 远程仓库 mirror和pom.xml中的repository

真正解决问题的是这篇文章，点赞！
[maven download jars](https://swenfang.github.io/2018/06/03/Maven-Priority/)
注： 可以用如`mvn -X dependency:tree`来查看maven debug信息。

nexus的作用就是替代中央仓库，完全自主控制公司或集团内部需要的下载的jar包，是提供了缓存作用
的maven仓库。
[how does a maven repository work?](https://blog.packagecloud.io/eng/2017/03/09/how-does-a-maven-repository-work/)
经过大半天折腾，我最后仔细的看了下那个没找到的jar包，原来就是现在这个多模块项目的子模块，
无语！
在相应目录下执行mvn install就好了。。。

2019.3.10加：
经返回查看书籍《maven实战》一书，查漏补缺知识总结如下:
1. mvn install即将自己的项目jar包安装到本地仓库
2. 远程仓库的配置
```txt
<repositories>
    <repository>
        <id></id>     <!--每个仓库id是唯一的-->
        <name></name>
        <url></url>
        <releases>
            <enabled>true</enabled> <!-- 可以下载release版本-->

            <!--默认daily-每天检查一次,其他有
            never - 从不更新
            always - 都更新
            interval: X - 每隔X分钟更新-->
            <updatePolicy>daily</updatePolicy> 

            <!--默认warn-构建时输出警告信息，其他有
            fail - 校验和错误时让构建失败
            ignore - 忽略校验和错误-->
            <checksumPolicy>warn</checksumPolicy> 
        </releases>
        <snapshots>
            <enabled>false</enabled> <!-- 不可以下载snapshots版本-->
            <updatePolicy>daily</updatePolicy> 
            <checksumPolicy>warn</checksumPolicy> 
        </snapshots>
        <layout>default</layout>   <!-- 布局为maven2或3,而不是maven 1的布局-->
    </repository>
<repositories>
```
3. 远程仓库需要认证时在settingsx.xml文件中配置server信息，id为repositoryId。
4. 将项目jar包部署到私服或其他远程仓库。
   1. 修改pom.xml文件
```txt
<distributionManagement>
    <repository>
        <id>proj-release</id>  <!--发布版本的仓库-->
        <name></name>
        <url></url>
    </repository>
    <snapshotRepository>
        <id>proj-snapshot</id>  <!--快照版本的仓库-->
        <name></name>
        <url></url>
    </snapshotRepository>
</distributionManagement>
```
   2. 从远程仓库下载jar包和部署jar包都需要认证，都是配置在settings.xml文件中。
   3. 执行命令`mvn clean deploy`,当前项目版本是release版本,maven会部署到发布版本仓库，
   当前项目若是snapshot版本，会被部署到快照版本仓库。
   > The Central Maven repository stores release artifacts. Snapshots capture a work 
   > in progress and are used during development. A Snapshot artifact has both a version 
   > number such as “1.3.0” or “1.3” and a timestamp.

   4. jar包版本是release或snapshot,latest时，maven首先需要根据远程仓库的更新策略来检查更新，
   `<release>`的`<enabled>`,`<updatePolicy>`的值来确定是否允许下载和是否检查更新（可以在命令行里
   使用-U来强制更新)。由于release,latest容易版本问题导致构建失败，所以maven 3中已经取消了
   对它们的支持，实际使用还是以具体版本号较多。

   5. 镜像仓库完全屏蔽了原仓库，当镜像不可用时，maven无法访问原仓库，所以此时无法下载jar包。

   6. 生命周期是maven自己定义的概念，具体的操作由不同的maven插件来执行，相当于设计模式里的
   模版方法。

   7. maven有3套相互独立的生命周期: clean(清理项目)、default(构建项目)、 site(建立项目站点),
   每套生命周期内部的阶段phase前后有依赖关系,某个生命周期的phase的执行对其他生命周期的phase
   没有影响。`mvn clean install`执行了clean生命周期的pre-clean,clean阶段，default生命周期的
   从validate到install的所有阶段。
  `mvn clean deploy site-deploy`实际执行了clean的pre-clean,clean阶段，default的所有阶段，
  site生命周期的所有阶段。
  > clean： pre-clean, clean, post-clean
  > site： pre-site, site, post-site, site-deploy
  > default: validate - initialize - resources - compile - test resources -
  > test compile - test - package - integration test - verify - install -deploy
  >
  > default基本流程为:
  > 初始化 - 处理主资源文件-编译主源码-处理测试资源文件-编译测试源码- 
  > 执行测试 - 打包 - 集成测试 - 验证 - 项目jar包安装到本地仓库 - 部署到远程仓库

  8. 单个maven插件可以完成多个功能。由于这些功能有很多可以复用的代码，所以将它们集合到一个
  插件中，每个功能点就是一个插件目标plugin goal,如命令`mvn dependency:tree`就是调用了插件
  maven-dependency-plugin的插件目标:列出项目依赖树。`mvn compiler:compile`是插件maven-
  compiler-plugin的compile目标。

  9. maven通过将生命周期阶段和对应的插件目标进行绑定从而实现具体的构建任务。如clean生命周期
  的clean阶段和maven-clean-plugin的clean阶段是默认绑定在一起的。clean生命力周期的pre-clean和
  post-clean阶段由于没有默认绑定插件目标，所以它们没有实际的行为。

  10. 可以自定义插件目标绑定到生命周期的某个阶段中，如可以将插件maven-source-plugin的jar-
  no-fork目标绑定到default生命周期的verify阶段从而实现在该阶段创建出项目的源码jar包。
  ```txt
  <build>
    <plugins>
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-source-plugin</artifactId>
            <version>2.1.1</version>
            <executions>
                <execution>
                    <id>attach-sources</id>
                    <!--如该phase配置省略，jar-no-fork默认绑定到package阶段执行-->
                    <phase>verify</phase> 
                    <goals>
                        <goal>jar-no-fork</goal>
                    </goals>
                </execution>
            </executions>
        </plugin>
    </plugin>
  </build>
  ```

  11. 插件配置。
     1. 可以在命令行进行配置，如命令`mvn install -DskipTests`就是在执行default生命
  周期从开始到install阶段的过程中跳过test阶段。
     2. 可以在pom声明该插件时配置该插件的某些全局属性，如maven-compiler-plugin的jdk
  版本。
  ```txt
  <build>
    <plugins>
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-compile-plugin</artifactId>
            <version>2.1</version>
            <configuration>
                <source>1.7</source> <!--编译jdk1.7版本的源文件-->
                <target>1.7</target> <!--生成与jdk1.7版本兼容的字节码文件-->
            </configuration>
        </plugin>
    </plugin>
  </build>
  ```
    3. 还可以针对插件目标绑定到某个生命周期阶段的具体任务进行插件配置。此时
    `<configration>`配置节点位于具体的`<execution>`节点下。

  12. 命令行里执行`mvn -h`可以看到其基本使用方法为`mvn option goal phase`,option为mvn命令
  执行时的一些参数，如-X等，goal为插件目标，如命令`mvn dependency:tree`,即mvn是可以直接从
  命令行调用插件目标的，这适用于那些不方便绑定到某个生命周期阶段的插件目标，如help:describe,
  dependency:tree等，其中help,dependecy叫做插件前缀，用来代替插件的groupId,artifactId,version
  信息,maven对前缀的解析分为几个步骤：
     1. maven有默认的groupId,有org.apache.maven.plugin, org.codehaus.mojo2个groupId,还可以
     在settings.xml文件的`<pluginGroups>`中配置自己的插件仓库groupId.
     2. 依赖的元数据位于groupId/artifactId/maven-metadata.xml中，插件的元数据位于groupId/
     maven-metadata.xml中，其中定义了每个插件前缀和artifactId的映射关系。
     3. 核心插件版本在超级pom中已经设定好了，而对于非核心插件并且没有设定版本号的插件，
     maven 2会解析到latest版本，maven 3会解析到release版本，不过这样还是容易引起版本问题，
     所以还是推荐指定插件版本号。

  13. maven属性，一般常见的为pom.xml中定义属性
  ```txt
  <properties>
    <spring.version>4.5</spring.version>
  </properties>
  # 依赖中就可以使用${spring.version}来替代具体的版本
  ```
  14. maven资源过滤，针对如src/main/resources资源目录下的文件，如指定不同环境的数据库JDBC
  配置,需要根据环境切换，和spring的profile类似，maven也提供了相同的功能。
     1. maven的profile可以在pom.xml文件，user/.m2/settings.xml文件(针对当前用户有效)，
     maven安装目录/conf/settings.xml文件(针对本机所有用户有效)这3个文件中定义，其中
     pom.xml文件由于可以加入版本控制，利于移植，所以pom.xml文件中profile可配置的属性最多，
     有repository,dependency,depencymanagement,build中的plugin,resource等，而
     settings.xml中的profile由于不方便分享，所以只能配置仓库和属性值。
     2. 在profile中定义不同环境的profile,如每个profile都有自己的JDBC配置，如db.url属性
     每个profile的值都不相同，然后在application.yml中使用${db.url}来替代具体的属性值，
     但是资源文件处理是由插件maven-resources-plugin处理的，但它功能是将项目的主资源文件
     复制到主代码编译输出目录，测试资源文件复制到测试代码编译输出目录，即它不会解析具体
     的${db.url}的值，所以我们需要在pom.xml中进行配置告诉它进行属性解析。
     ```txt
     <build>
         <resouces>
            <resource>
                <directory>${project.basedir}/src/main/resources</directory>
                <filtering>true</filtering>
            </resource>
         </resouces>
     </build>
     ```
     测试资源目录配置相同,目录由main改成test即可。
     3. 最后，激活需要使用的profile即可得到需要的配置属性。
       1. 命令行激活 `mvn clean install -Pdev`激活了dev profile.
       2. settings.xml文件中`<activeProfiles>`配置来永久激活某些profile.
       3. 系统属性，操作系统不同，某个文件存在与否都可以用来判断是否激活某个profile.
       4. 默认激活，在以上方式没有任何一种已经激活的情况下，选择默认激活，`<profile>`下
       的`<activation><activeByDefault>true</activeByDefault></activation>`来默认激活。

  15. web资源过滤，对于src/main/webapp目录的资源如果也想开启资源过滤解析属性功能时，
  由于它是有插件maven-war-plugin控制的，所以需要对该插件进行配置。
  ```txt
  <profiles>
    <profile>
        <id>client-a</id>
        <properties>
            <client.logo>a.jpg</client.logo>
            <client.theme>red</client.theme>
        </properties>
    </profile>
    <profile>
        <id>client-b</id>
        <properties>
            <client.logo>b.jpg</client.logo>
            <client.theme>blue</client.theme>
        </properties>
    </profile>
 </profiles>

<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-war-plugin</artifactId>
    <version>2.1-beta-1</version>
    <configuration>
        <webResources>
            <resource>
                <filtering>true</filtering>
                <directory>src/main/webapp</directory>
                <includes>
                    <include>**/*.css</include>
                    <include>**/*.js</include>
                </includes>
            </resource>
        </webResources>
    </configuration>
</plugin>
  ```
  16. 聚合
  聚合的作用是可以一条maven命令同时构建多个项目。

  maven聚合模块的groupId, versionId一般与被聚模块相同，聚合模块的打包方式packaging不能为
  jar或war，必须为pom.
  module元素的值代表的是被聚模块的相对路径，如聚合模块pom路径为D:/code/parent/pom.xml,module
  为`<module>module1</module>`，代表它有被聚模块D:/code/parent/module1（即这个值代表的是目录名）
  module1有自己的pom.xml,src/main/java, src/test/java等，可以独立构建。
  以上是父子目录结构，如果是平行结构，即聚合模块和被聚模块处于同级目录下时，module为
  `<module>../module1</module>`.

  17. 继承
  继承的作用是消除重复，包括依赖，插件等。

  与聚合相同，父模块的packaging也必须为pom，它也不需要pom.xml之外的src/main等文件，只是为
  了消除重复。继承体现在子模块pom.xml的parent元素中。

  父项目中使用dependencyManagement元素可以定义统一的依赖groupId,artifactId,version和scope,
  它并不会实际引入依赖，子模块中只需要定义groupId和artifactId即可引入该依赖，version和
  scope由dependencyManagement继承而来，这样统一管理了依赖版本。

  可以继承的pom元素主要有
  `groupId,versionId,properties,dependencies,dependencyManagement,repositories,build`
  
  其中dependencyManagement除了可以复制和继承来实现复用外，还可以通过`<scope>import</scope>`
  来引入。即import只有在dm元素下生效，将另一个dm内容引入到当前的dm中。
 ```txt
 <dependencyManagement>
      <dependencies>
          <dependency>
              <groupId>org.springframework.cloud</groupId>
              <artifactId>spring-cloud-dependencies</artifactId>
              <version>${spring-cloud.version}</version>

              <-- import的都是pom packaging-->
              <type>pom</type>
              <scope>import</scope>

          </dependency>
      </dependencies>
  </dependencyManagement>
 ```

类似的，插件也有依赖管理pluginManagement,对一些核心插件的配置，如maven-compiler-plugin
对编译jdk版本的控制，maven-resources-plugin对编码格式定为utf-8的控制等，可以在父模块中
定义即可，插件完全不用配置即可使用该插件，原因如下：
1. 生命周期默认绑定的插件不需要显式的配置。
2. 超级pom定义了这些默认插件的版本。
3. pluginManagement定义了这些插件的行为。

经测试，父项目中直接定义plugins标签，子模块可以继承得到该插件。

  18. 聚合与继承
  聚合与继承目地不同，聚合只要聚合模块知道哪些被聚合了，继承只有子模块知道自己的父模块。
  实际开发中为了方便，通常会将聚合与继承合为一个项目。即该父pom中元素有module,properties,
  dependencyManagement,pluginManagement.

  19. maven的约定
  maven默认的java源代码目录是src/main/java,测试源代码目录src/test/java,这个约定是在maven的
  超级pom中定义的，maven3的super pom位置为$MAVEN_HOME/lib/maven-model-builder-x.x.x.jar中。

  20. maven依赖传递总结
  相同依赖不同版本的调解原则：
     1. 就近原则，离根路径短者优先。
     2. 声明优先，路径相同时先声明者优先。
  传递范围：
  compile: 默认范围，编译，测试，运行都有效
  test:   只对测试时有效，编译和运行无效，如junit
  provided: 编译和测试有效，运行无效，如servlet api,运行时外部容器tomcat等已提供。
  runtime:  测试和运行有效，编译时无效， 如jdbc驱动的实现类，编译时只需要接口，运行时才需要实现。

  依赖传递表左边一列是第一依赖，上面一行是第2依赖。
  简单总结为：
     1. 第二依赖为compile时，传递依赖范围以第一依赖为准。
     2. 第二依赖为test时，无法传递。
     3. 第二依赖为provided时，只有第一依赖也为provided可以传递，其他范围不能传递。
     4. 第二依赖为runtime时，范围以第一依赖为准，除了第一依赖为compile时，其范围为runtime.

  依赖优化：
     1. 使用exclude标签去除冲突的依赖。
     2. 使用properties标签统一依赖版本号。
     3. 使用mvn dependency:list, tree, analyze查看依赖情况。

  21. 反应堆
  在一个多模块项目中，如上层目录是聚合模块，父项目是其他子模块的平级目录，则从聚合模块中
  执行`mvn clean install`命令时，maven会按照一定顺序确定构建的顺序，
  即所有模块构成的构建结构叫做反应堆（reactor),该顺序为反应堆的构建顺序。
  
  maven按顺序构建pom,如果该模块有依赖，则先构建依赖，如果该依赖还有前置依赖，则也先构建该
  前置依赖，依次类推。

  如果想一次构建所有项目时，直接执行`mvn clean install`即可，如果模块非常多，想一次构建
  其中部分模块，跑到每个模块下执行该命令过于麻烦，可以在父目录下带上命令行参数实时裁剪
  反应堆，这里记录下以供以后使用。
```txt
使用mvn -h查看
mvn clean install
-pl  --projects  构建指定的模块列表，用逗号分割，只会构建模块本身，不构建依赖或下属
-am  --also-make 同时构建它依赖的模块，如构建子模块时，会同时构建父模块parent
-amd -also-make-dependents  同时构建下属依赖，如构建父模块时，会同时构建所有子模块
-rf  -resume-from  在已有反应堆顺序的基础上，可以指定从某个模块开始构建
可以在-pl,-am,-amd的基础上使用-rf来精确控制。
```

2019-08-02 14:58:50 添加:
最近项目上经常因为某些包有安全漏洞需要升级版本，但由于银行内部的nexus仓库没有最新的版本
或者说依赖包不全，这时候就需要链接外网到阿里的镜像仓库中下载，这时问题来了，如何编写maven
配置文件settings.xml使得通过ali镜像下载的包可以和通过内网下载的包一起生效？

问题背景是工作是用的虚拟机，虚拟机设置的是按特定网卡链接到虚拟机(还是搞不太清楚具体的虚拟
机网络配置), 总之，外网和内网不能同时访问。

链接外网时，将内网的repository注释掉时发现aliyun还下载了其他不需要更新的包。
所以个人认为，下载的包中有记录该包所属的仓库信息，需要在settings配置中保留内网的repository,
这样maven就不会到新仓库中去下载本地已有的包了。
所以使用以下配置即可，以后无论链接内网或外网，都不应当也不需要更改配置:
```txt
<mirrors>
  <mirror>  
       <id>publicRepo</id>  
       <name>publicRepo</name>  
       <url>内网</url>  
       <mirrorOf>central</mirrorOf>          
   </mirror>
 </mirrors>
 <profiles>
    <profile>
      <id>nexus private</id>
      <repositories>

       <repository>
         <id>ccb</id>  
         <name>ccb</name>  
         <url>内网1</url>  
       </repository>
       <repository>
         <id>ccb2</id>  
         <name>ccb2</name>  
         <url>内网2</url>  
       </repository>
       <!--  其他更多内网url地址， 最后放外网的aliyun地址，这样就可以最大程序利用
       已经有的本地jar包，不用重复下载-->
       <repository>
         <id>alimaven</id>  
         <name>aliyun maven</name>  
         <url>http://maven.aliyun.com/nexus/content/groups/public/</url>  
       </repository>

     </repositories>
   </profile>
 </profiles>
 <activeProfiles>
    <activeProfile>nexus private</activeProfile>
 </activeProfiles>
```
2019-08-05 14:35:24添加:
还是以上的版本升级问题，相应jar包下载成功后，在pom.xml中指定要升级的特定版本，结果项目启动
报错，无法初始化ObjectMapper类。
网上说maven编译成功，但运行报错的情况，还是jar包依赖有冲突。这次是要升级jackson-databind
版本到2.9.9.2，使用mvn dependency:tree命令发现它依赖的jackson-core和jackson-annotation还是
旧版本，查看2.9.9.2的pom文件找到它依赖的core和annotation具体版本，指定以后项目启动成功！

注: 以上就是解决问题的具体办法，在网上搜索的过程中，如果是自己的项目需要升级springboot中的
某个版本，网上说首先是升级springboot本身的版本，这也是最安全的。其次就是在自己的pom.xml使用
properties配置项指定要升级的版本，这样也不需要自己声明依赖，也比较安全。最后实在无法解决，
才是自己显式的声明依赖版本。

由于maven依赖的就近原则和声明优先原则，所以依赖的版本有冲突时会被忽略，但升级依赖时冲突的
依赖关系会留下隐患(如上面的maven编译成功，运行报错的情况),所以可以使用
`mvn dependency:tree -Dverbose -Dincludes=groupId:artifactId`来查看某个依赖的重复引入情况，
-Dincludes选项省略即为全部依赖的情况。

由以上问题也可以看出，当子模块继承了父模块时，当子摸块没有具体指明依赖版本时就会使用父模块的
dependencyManagement对子模块影响很大，这对于依赖传递也是同样的效果，所以出问题时可以通过
mvn dependency:tree命令查看具体的依赖版本是否正确。

2020-04-13 21:55:34 添加:
刚又碰到个maven的问题，这里记录下。
场景是需要从公司的nexus私服中下载一些jar包，但它需要开vpn, 并且该vpn只有windows版本，我想
下载包到mac环境使用，所有需要在windows虚拟机中下载好包后到mac中使用。
windows虚拟机中安装好jdk, mvn变量后，下载发现localRepository中没有需要的包，后经过开启
-X查看，发现依赖路径不对！
这里maven, jdk都是windows上的，项目本身在mac上，在项目路径下执行maven打包命令时，发现它的依赖
根路径自动切换为mac上，所以我之前写的localRepository=/z/.m2/repository会多出一层z文件夹，
直接改为/.m2/repository即可。因为项目的classpath是Z盘，maven有可能取得是这个根路径.


## Babun
因为vimrc里的mapleader报错，发现babun里面的vim还是版本7的，于是用pact update vim来更新vim，结果
运行完成后命令vim没有反应，网上搜索说可以更新cygwin，babun update命令有问题，
可以手动更新babun from executing C：\Users\LYPC\.babun\update.bat

上面命令自动运行的cygwin下载速度太慢，还会卡死，所以还是自己来装....
1. 到官网上下在64位cygwin安装器，镜像地址 http://mirrors.sohu.com/cygwin/
2. [https://github.com/babun/babun/wiki/64-bit](https://github.com/babun/babun/wiki/64-bit/)

> cp -a /cygdrive/c/Users/LYPC/.babun/cygwin-32/home/ThinkPad-T540p/.* ~/
cp -a /cygdrive/c/Users/LYPC/.babun/cygwin-32/etc/{group,minttyrc,nanorc,passwd,vimrc} /etc
cp -a /cygdrive/c/Users/LYPC/.babun/cygwin-32/usr/local/bin/* /usr/local/bin/
cp -a /cygdrive/c/Users/LYPC/.babun/cygwin-32/usr/local/etc/* /usr/local/etc/
pact install gcc-core $(cat /usr/local/etc/babun/source/babun-packages/conf/cygwin.x86.packages | tr '\n' ' ')

pact install 下载地址可以添加镜像
我的是C:\Users\LYPC\.babun\cygwin\home\ThinkPad-T540p\.pact地址下修改pact.repo文件
将第一行默认的kernel注释掉，加上
> PACT_REPO=http://mirrors.sohu.com/cygwin/

执行babun install脚本时oh-my-zsh卡住了，找了个镜像可以用
https://bitbucket.org/zalew/oh-my-zsh-mirror.git

一通折腾过后，babun里vim变成了8.0.1567，但是mapleader还是报错，mac里也报错，看来是脚本本身的问题，不过目前使用
mapleader正常，看来不影响使用,vim的高级用法以后还是要多看看帮助文档，记录零散知识。

## Git
今天建行里面做了Git的简单培训，其中提到2个场景，因为以前也使用git,但对这2种场景具体处理办法
还不是很清楚，查询了他人的博客特地总结如下：
### 开发上线后产生了一个bug，当前还在开发新功能，如何回退到线上版本修改bug并提交？
其中最关键的是`git reflog`命令

1. 上线最好要打一个tag，方便以后回退版本，查看问题等
> git commit -m 'version 1.0'
> git tag v1.0

2. 这时已经开发到后面的功能，发现v1.0版本有bug,则进行回退修复处理，在出问题的master分支上
先找到v1.0的commitId
> git tag  # 查看所有tag
> git show v1.0  # 从中找出该tag的commitId
> git reset --hard commitId
> git checkout -b bugfix  # 新建bugfix分支
> git checkout master     # 先回master分支
> git reflog # reflog记录了最近几次的动作包括分支转换，从中找到git reset前最近一次
> 提交的commitId
> git reset --hard commitId    # 这时master分支回到起始状态
> 
> git checkout bugfix   # 切换回bugfix分支，面对的是干净的有bug的版本v1.0
> git add -a . && git commit -m 'bug fixed'  # 修改bug并提交
> git tag v1.1   # 可以打上标签为v1.1
> 
> git checkout master   # 切换回master
> git merge bugfix    # 合并bugfix内容
> 解决冲突后
> git add -A .    # 冲突的文件需要重新暂存
> git commit -m 'bug fixed'   # 解决bug
> 标签需要手动推送到远程仓库，可以使用命令
> git push origin --tags  # 推送所有tags到远程仓库

### 解决冲突
1. 合并后产生冲突，可以使用`git merge --abort`放弃这次合并，回到合并前的状态。
2. 使用合并工具`git mergetool`会调用一个可视化工具来解决冲突。
3. `git diff commitId...commitId`可以用来查看版本差异，可以手工找到共同祖先，拿到fetch后
的commitId.
4. `git show :1:filename`查看共同祖先的版本，`git show :2:filename`查看当前分支head版本，
`git show :3:filename`查看远程分支merged_head版本。

```txt
1. 多提交，少推送。多人协作时，推送会频繁地带来合并冲突的问题，影响效率。因此，
尽量多使用提交命令，减少合并的使用，这样会节省很多时间。
2. 使用Git流（Git Flow）。
3. 使用分支，保持主分支的整洁。这是我强烈推荐的一点，在分支进行提交，
然后切到主分支更新(git pull —rebase)，再合并分支、推送。这样的流程会避免交叉合并的情况出现
（不会出现共同祖先节点为多个的情况）。事实上，git合并操作让很多人感到不知所措的原因就是
各种原因所产生的交叉合并问题，从而造成在合并的过程中丢失某些代码。
保持主分支的整洁能够避免交叉合并的情况出现。
4. 禁用fast-forward模式。在拉取代码的时候使用rebase参数（前提是保持主分支的整洁）、
合并的时候使用—no-ff参数禁用fast-forward模式，这样做既能保证节点的清晰，
又避免了交叉合并的情况出现。
```
关于fast-foward
```txt
当前分支合并到另一分支时，如果没有分歧解决，就会直接移动文件指针。
这个过程叫做fast forward。
例如，开发一直在master分支进行，但忽然有一个新的想法，于是新建了一个develop的分支，
并在其上进行一系列提交，完成时，回到 master分支，此时，master分支在创建develop分支之后
并未产生任何新的commit。 此时的合并就叫fast forward.
可以看到master在合并develop分支的时候并没有产生新的节点回到develop分支，对代码进行修改，
提交。切换到master分支，使用git merge develop --no-ff 进行合并，此时会产生一个commit节点.
很明显使用--no-ff合并时，在删除develop分之后，该分支的合并信息仍然被保留，
在以后的代码分析中可以便捷的查看到历史信息，而fast forward方式则无法辨识代码的合并信息。
```
### Git分支模型使用总结
1. master分支是一个长期维护的主分支，主要作用是存储稳定的正式版本内容，数据来源于合并其他
分支(如develop,修复紧急bug的短期分支等)，合并完以后打上版本号即可以正式发布。
2. develop分支是另一个主分支，develop分支主要用来存储下个版本的最新变化,也不好用于直接干活，
可以用来合并其他短期分支(如某个功能分支，修复bug分支等).当版本稳定时，可以将develop分支合
并到master分支并打上标签作为新版本发布。
3. 用于真正干活的短期分支(如功能分支，修复bug分支等),完成后合并到develop分支。
具体命令操作如下：
```txt
git checkout -b some_feature develop   # 从develop分支创建某功能开发分支

# developing...then merge it to develp branch,before that,rebase pull first

git checkout develop  # 以下操作都在develop分支下进行
git pull     
git merge --no-ff some_feature  # 不使用fast-forward模式，保留合并信息
git branch -d some_feature   # 删除该短期分支
git push origin develop  # 推送到远程develop分支,这里默认本地develop分支追踪远程develop分支
```
develop分支合并到master分支过程基本相同，只不过记得打上标签tag,并使用命令`git push --tags`
来推送tag。

注： 如在develop分支上执行命令`git rebase master`将会导致develop分支上与master分支分离的
后续全部提交变成补丁(patch),git会逐个将这些补丁添加到现有的master分支上，从而使得master
分支与新的develop分支在一条直线上。`git pull`相当于`git fetch && git merge`,而`git pull 
--rebase`相当于`git fetch && git rebase`,像上文引用的那样，虽然这样保持了分支整洁，但是
在rebase的过程中容易出现问题，毕竟它改变了提交历史，风险很大，所以还是正常`git pull`为好。

### git submodule
带有submodule子模块的项目进行全部更新，根据`git pull --help`的说法，在已经checkout 
submodule的情况下，可以使用下面命令来一次性更新主项目和子模块：
> git pull --recurse-submodules

### git回退单个文件到指定版本
1. cd到文件父目录
2. git log filename
3. git reset commitId filename (对于文件名不能使用hard模式,默认mixed模式)
> git reset --soft  只回退commit信息，即head指针，index和worktree不变，可以用来压缩commit
> git reset --mixed 默认方式，回退commit和index,worktree不变，回退后需要checkout
> git reset --hard  commit,index,worktree都回退

4. git checkout filename
5. commit and push, done!

### git修改默认的推送远程仓库
因为我的代码现在是放在2个地方，一个是github, 另一个是腾讯的coding(也是担心万一哪天github
把中国屏蔽了...), 所以代码一般有2个远程，推送时明显coding要快，github慢很多。所以我想将
`git push`命令设置成默认推送到coding(本地和远程分支相同), 用`git push github`再推送到github
上。

我们第一次push时会执行命令`git push -u origin master`，这一步就是设置了默认的推送仓库(origin)
和分支(master).所以使用这个命令即可，之后可以使用`git branch -vv`查看分支跟踪情况，确定
是否设置成功。

不带参数的`git push`命令只会推送当前分支，这是git默认的simple方式。可以设置
`git config --global push.default matching`, 这样它会推送所有有对应远程分支的本地分支，
这种方法有风险，因为多个分支一起push如果没准备好会出现错误，所以应当避免使用matching.
还可以设置为current, current和simple类似，但默认的simple推送时要求当前分支对远程仓库有
追踪关系，否则报错。而current则不要求，如果没有同名的远程分支，`git push`会自动新建同名
的远程分支。

个人觉得最稳妥的方式是保持默认的simple方式不变，当需要推送新分支时，使用git push全命令，
如`git push github newBranch:newBranch`, 其中本地分支和远程分支名字需要保持一致。推送时
到每个分支下分别执行`git push`命令。如果实在修改了很多分支，想要一次性推送，可以使用
`git push -all`，-all选项不会检查分支追踪情况，意味着它也会将新建的本地分支推送到远程仓库。

注: 简单来说，push.default的选项中upstream是根据追踪关系来确定推送分支，current是根据分支
名称，simple则是结合了upstream和current, 最严格也最安全，要求同时有追踪关系和相同分支名称。

### git cherry-pick
当git有多个分支时, 需要写一个特性或补丁同时提交到多个分支时,可以使用git cherry-pick.
**它默认只提取最后一个commit.**
```txt
git checkout A
git commit -m "Fixed the bug x"
git checkout B
git cherry-pick A
```
 2020-12-17 10:07:57 added:
 when developing in local branch, it is common to cherry-pick to test or other branches
 to make sure the deploy the latest code, so I wrote a script to auto-do this:
 ```txt 
#!/bin/bash

echo "Are you sure the all related branches is clean? (y/n):"
read XN

if [ "$XN" != "y" ]; then
  echo "Abort!!"
  exit
fi

if [[ -z "$1" || -z "$2" ]]; then
  echo "Usage: cherryPick.sh [starHash]^..[endHash] [<branch1> <branch2> <branch3> ...]"
  echo 
  echo "e.g. cherrypick.sh xxxxxx^..yyyyyy master test"
  exit
fi

for branch in "${@:2}"
do
  #echo $branch
  git checkout $branch
  git cherry-pick -x -s $1
done
 ```
 in real usage, we need get the start commit hash code, remember the same commit content
 has different hash code in different branches, so when we need to check the 
 cherry-pick-soure branch like local to get the right hash code, and we can use below code
 the get the pretty one-line content of git log:
 `git log --pretty=format:"%h%x09%an%x09%ad%x09%s"`
 %h is hashcode short, %x09 is tab: as spaces format, %an is author, %ad is author date, 
as `git commit --amend` will change the author date(we use it to modify commit message),
so we can also use commit date as %ci, but normally it is the same, and for me, the
created author date is more important as developing sequence.
Furthermore, I need to cherry-pick one whole days' commits to other branches, so we can 
use this to find out all the commits after yesterday,
so today is 2020-12-17, I need to get all the commits today committed, command like:
`git log --after="2020-12-17T00:00:00" --pretty=format:"%h%x09%an%x09%ci%x09%s"`

furthermore, we can use alias to make this quite convenient, in bash shell alias command:
 ```txt
 alias todaylog='git log --after="$(date '+%Y-%m-%dT00:00:00')" --pretty=format:"%h%x09%an%x09%ci%x09%s"'
 ```
 
 2020-12-25 09:54:06 added: 
when working with several git branches at once, use the git cherry-pick to apply all changes
to different branches is convenient, but how can I push all modified branches to remote at
one time, the answer is quite simple, searching on internet and stackoverflow will get the 
answer: 
```txt
git push REMOTE --all   // push all tracked branches
git push REMOTE --tags  // push all tags
```
simply, `--all` is enough. 

 2021-03-25 09:45:04 added:
the above cherry-pick script is convenient, but after using it for some time, it is
troublesome to get the commit hash id by hand, after searching online, I found what I
wanted actually is synchronize the local two branches, and git pull equals git fetch && 
git merge, as there is no remote branch here, so git fetch will fail.
So I just need to use git merge or git rebase!!!
```txt
# synchronize local master commits to local dev branch
git checkout local
git rebase master
```
 2021-03-25 16:25:05 added:
 after testing, I got what I wanted:
  1. git checkout local from master
  2. change to local config, as ip and others, commit it
  3. git checkout master
  4. git merge or rebase local  to get the local changes
  5. revert that commit, this generates a new commit to return to prod config
  6. git checkout local, commit changes and merge it to master is ok now
by this way, we can not directly change master branch, if we do that, we can only use
the above cherrypick script to make that change to local branch.

So make it safe, start local tomcat, and change code in local branch, after testing ok, 
merge it to master branch, and push all.

So for frontend changes, we can use cherrypick script to avoid local tomcat starting, 
for tomcat server changes, we can use the right way merge, we can change to master branch
to test the prod database. 

 2021-03-26 13:42:47 added:
 when using frontend and merge changes from master to local branch, after testing, 
 need to do below steps:
 1. make commit in master branch
 2. git checkout local
 3. git cherry pick from master
 4. git checkout master
 5. if we just git rebase local, we will have two same commits, so we need to reset hard
 back to the commit just before the change commits
 6. git rebase local

so, simply put it, we make commit in master, move it to local, then go back to master to 
clean that commit and use rebase to get that commit back, in this way, the master and 
local branches synchronized.

ps: after testing, use git rebase local in master branch is ok, but it will conflict with
remote master branch, we can not push it normally, so use git merge local instead.

### github default main branch problem

as we all know, for racial discrimination problem, github change its default branch name
from master to main, but if we use the git init command, it will still create the master
branch for us, in this situation, we can only make our local master branch tracking the 
remote main branch, we have two methods below to solve this problem.
```txt
1. git branch -m master main
   git push -u --force origin main
2. git push -u --force origin master:main
```
the second method is convenient, but we need to remember the remote branch name is main,
so the first method is recommended.

## Windows10 自带微软拼音输入法支持小鹤双拼输入法
本来还是用搜狗，但是虚拟机内无法联网登录，结果经常重启虚拟机后搜狗的设置全部都不见了，
非常麻烦，今天终于找到了让win10自带的拼音输入法支持小鹤的方法：
```txt
1. win + R，输入 regedit，打开注册表
2. 找到  计算机\HKEY_CURRENT_USER\Software\Microsoft\InputMethod\Settings\CHS 项
3. 新建一个名为 UserDefinedDoublePinyinScheme0 的字符串值，值为 小鹤双拼*2*^*iuvdjhcwfg^xmlnpbksqszxkrltvyovt
4. 打开控制面板--微软拼音输入法设置，把 小鹤双拼 设置为双拼的默认选择即可。
可以在区域中添加Enlish(United State),在高级键盘设置中设置英语为默认输入法，
同时勾选为每个窗口使用不同输入法，默认切换输入发快捷键为windows+space键。
```

## MacOS中vim添加中文输入法支持插件
linux下的fcitx.vim插件对于输入中文非常有效果，尤其是对于写这样的长篇中文博客来说，
有时切换中文输入非常麻烦，但是fcitx.vim是linux下的，mac不支持，今天又在网上搜到
有牛人写了个工具，可以迁移到macOS系统中来。简记如下：
```txt
vundle
Plugin 'CodeFalling/fcitx-vim-osx'

:PluginInstall

brew tap codefalling/fcitx-remote-for-osx
brew install codefalling/fcitx-remote-for-osx/fcitx-remote-for-osx --with-sogou-pinyin
Set your shortcut for Select next source in input menu to Ctrl-Shift-z
And set your English input method to US（美式英语）
```
OK！
 2020-03-22 14:10:51添加:
使用该插件后打开vim文件中会出现乱码，暂时无法使用了....

## Karabiner针对某个app的快捷键设置
作为程序员快捷键必不可少，尤其是使用vim时，个人认为esc和capslock的位置必换不可。交换主要
还是通过各种改键程序来实现：
1. windows我用key tweak + hotkey, 可以交换键和快捷启动某些程序，
如F12启动cmder，windows+c启动cmd窗口一样。

2. linux ubantu下有gnome-tweak-tool或Xmomap文件等。

3. macOS有利器karabiner，而且有配套的keyEvent-viewer可以查看按下键的名字等，非常好用，
这次就是用它来针对某个特定的app进行设置快捷键。
背景：因为经常要用pdf阅读器查看技术书籍，需要经常在鼠标和键盘之间切换非常麻烦，ubantu下
自带的document viewer支持vim的操作，还有zathura也支持，说到底就是一个连续翻页的基础上
使用j向下滚动，k向上滚动的功能，在网上搜索到可以使用karabiner针对特定的app来定义快捷键。
```txt
vi ~/.config/karabiner/assets/complex_modifications/pdf-viewer.json
内容为（其中bundle_identifiers可以由keyEvent-viewer查看)
{
  "title": "keys",
  "rules": [
    {
      "description": "shortcuts for preview",
      "manipulators": [
        {
          "conditions": [
            {
              "bundle_identifiers": [
                "^com\\.apple\\.Preview$"
              ],
              "type": "frontmost_application_if"
            }
          ],
          "from": {
              "key_code": "k"
          },
          "to": [
            {
            "key_code": "up_arrow"
            }
          ],
          "type": "basic"
        },
        {
          "conditions": [
            {
              "bundle_identifiers": [
                "^com\\.apple\\.Preview$"
              ],
              "type": "frontmost_application_if"
            }
          ],
          "from": {
              "key_code": "j"
          },
          "to": [
            {
            "key_code": "down_arrow"
            }
          ],
          "type": "basic"
        }
      ]
    }
  ]
}


Got to karabiner preferences->complex Modifications->Add rule and press enable on it.
```

## 谷歌浏览器访问本地文件CORS错误

这个问题是由于本人有个静态网站目录存储在本地，直接访问index.html文件报错CORS.网上搜索到
解决方案如下。

1. 先关闭所有浏览器实例，从命令行启动谷歌浏览器:
`.\chrome.exe --allow-file-access-from-files`

2. 使用npm的http-server模块或python的SimpleHTTPServer模块,python3中该模块被整合进
http.server模块中，使用python3测试执行以下命令:
```txt
python --version   // 3.6.0
cd 到想要访问的files folder下，我这个路径下有个index.html文件
python -m SimpleHTTPServer  
谷歌浏览器访问http://localhost:8000或http://localhost:8000/index.html可以正常访问
```

## kindle, pocket, calibre, pandoc
昨天在网上看到QuQu的博客中有一个将自己的博客制作成电子书发到kindle上的效果，瞬间恢复了对
kindle的热情，这里简单记录下自己尝试的过程:
1. 使用pandoc将自己的博客markdown文件列表统一转换为一本epub电子书，这一步是使用haskell编写
的pandoc工具完成的，我写了一个脚本来获取博客中post文件夹下的所有md文件，统一拼接成一个字符串
作为pandoc命令的输入文件参数。
2. 生成epub后，由于亚马逊个人文档最大50M,邮箱附件最大20/30M的限制，所以我是用calibre转换
为azw3格式后直接用usb传到kindle中的。(也试过亚马逊官方的kindlegen, 也能生成，不过calibre
还支持从pdf转换到azw3, 功能更强大，所以就放弃了kindlegen, 统一使用calibre吧)。

将自己喜欢的网页保存下来制作成电子书。这个首先要说Pocket这个app, 有chrome插件，ios app, 
PC 多个平台，和印象笔记差不多，不过印象笔记免费用户限制较多。

pocket的Chrome插件的帐号设置界面中可以导出文章列表的html, 自己写一个脚本将其中的超链接的
href值提取出来，导入到oneTab中，全部打开后再用EpubPress统一转换为epub格式。
这样很麻烦，但对于零散的文章可以先在pocket中查看，进一步筛选后再做成电子书。
注: 可以简单的使用grep的正则表达式来提取url,命令如下:
`grep -Po "(?<=\")http(s)?://.*?(?=\")" ril_export.html > test.txt`

或者放入pocket中时就使用EpubPress做成电子书，再用calibre将所有零散的epub整合成一个大的epub.
calibre需要在偏好设置中安装新插件EpubMerge合并插件(还可以安装EpubSplit拆分插件)。

2019-08-30 10:51:13添加:
通过oneTab插件导入url,再通过EpubPress插件来生成epub电子书操作明显很麻烦，关键在于Epubpress
的网页内容抓取。所以我到它的github上查看其源码，希望能找到抓取的逻辑。

这时又发现EpubPress同时提供了EpubPress.js可以调用，并且ReadMe.md中介绍了使用方法，
所以我们就可以自己写个js使用node直接运行来生成需要的epub,而不再需要使用chrome插件。

EpubPress.js的抓取逻辑是先用node-fetch包的fetch方法抓取对应网站的全部内容，再用fileSaver.js
包保存的网页文件。

1. 安装EpubPress.js
`sudo npm install --save epub-press-js`

2. 写脚本调用EpubPress.js生成epub文件
这应该是写的第一个有用的node.js脚本了，node还是不错的，还可以调用shell命令。
node使用的是Chrome的V8引擎，FileSaver.js说它支持的chrome浏览器MaxBlog = 2GB, 如果理解的
没错的话，生成的epub最大也应该有2GB, EpubPress.js中没有看到其他限制，等以后pocket文章多了
以后看看是不是这个最大值。

可以加入koa, koa-route的node.js调试框架，测试node-fetch包的fetch方法运行结果。
调试node.js命令为`node --inspect test.js`.开发工具中点击node图标可以打开node.js的调试窗口。

getEpub.js代码如下:
```txt
const path = require('path');
var fs = require('fs');

// put pocket's html in blog directory, no need to contain in this blog
const data = fs.readFileSync(path.resolve(__dirname, '../ril_export.html'), 'utf-8');

console.log(data);
console.log('#####################################');
console.log('pocketFile read done!')
console.log('#####################################');
// 删除不匹配的内容，用正向否定环视定位，.*来具体匹配字符
const regexp = RegExp('(?<=")http(s)?://.*?(?=")', 'g');
let urlArr = [];
while((matches = regexp.exec(data)) != null){
  console.log(matches[0]);
  urlArr.push(matches[0]);
}

console.log('#####################################');
console.log('get url done!')
console.log('#####################################');

const EpubPress = require('epub-press-js');
const ebook = new EpubPress({
    title: 'Tao Pocket WebPages' + new Date().toLocaleDateString(),
    description: 'Personal favourite webpages',
    urls: urlArr 
});
ebook.publish().then(() => {
  // it will download to the current directory
    ebook.download();  // Default epub or ebook.email('epubpress@gmail.com')
}).then(() => {
   console.log('Success!');
}).catch((error) => {
    console.log(`Error: ${error}`);
}).then(() => {
  console.log('#####################################');
  console.log('epub done!');
  console.log('#####################################');
});
```
直接运行`node getEpub.js`命令，等待脚本执行结束后在当前目录可以看到生成的epub文件。

## Linux上安装jdk8, maven 
很神奇的是这么久在玩linux系统，但一直使用windows下的idea开发，主要还是因为认为快捷键是和
windows系统绑定的，最近想通了，完全可以将快捷键直接移植到Linux中。
1. IntelliJ 安装，这里略过。
2. 安装jdk8.
```txt
sudo apt install openjdk-8-jdk
sudo vi /etc/environment  # 添加以下环境变量
  JAVA_HOME="/usr/lib/jvm/java-8-openjdk-amd64"
```
3. 安装maven 3.6.1 这里我直接是使用.zip格式的安装包，直接解压即可
```txt
sudo vi /etc/environment  # 添加以下内容
  path变量最后添加 :/home/tao/wtt/apache-maven-3.6.1/bin 
  M2_HOME="/home/tao/wtt/apache-maven-3.6.1"

# update mvn commnad
sudo update-alternatives --install "/usr/bin/mvn" "mvn" "/opt/apache-maven-3.6.0/bin/mvn" 0
sudo update-alternatives --set mvn /opt/apache-maven-3.6.0/bin/mvn

# mvn commnad autoComplete
sudo wget https://raw.github.com/dimaj/maven-bash-completion/master/bash_completion.bash --output-document /etc/bash_completion.d/mvn

# logout and login
mvn --version

# 修改settings.xml文件 添加阿里云镜像仓库
<mirrors>
  <mirror>  
       <id>alimaven</id>  
       <name>aliyun maven</name>  
       <url>http://maven.aliyun.com/nexus/content/groups/public/</url>  
       <mirrorOf>central</mirrorOf>          
   </mirror>
 </mirrors>
```

## 关于pip的2个问题
1. pip install报错
```txt
File "/usr/bin/pip",line 9, in <module>
  from pip import main
Import error: cannot import name main
```
解决: 这是pip 10和pip 8冲突导致，卸载pip 10即可，ubantu上应尽量使用apt.
`python -m pip uninstall pip`

2. pip uninstall 不会删除相关的依赖包
```txt
pip install pip-autoremove 
# 如删除batmon的相关依赖
/home/tao/.local/lib/python2.7/site-packages/pip_autoremove.py batmon -y
```

## 使用shell脚本来重启sprintboot应用
通过查资料和以前的一些印象终于搞出个能用的......
```txt
#!/bin/bash

export SPRING_PROFILE=prod
export APP_NAME=pra-plat
export VERSION=1.0.0-SNAPSHOT
export SERVER_PORT=8080

## setting log home
export JAR_HOME=/home/ap/cloudapp
export LOG_HOME=/home/ap/cloudapp/logs
export LOG_NAME=${APP_NAME}


# =两边不能有空格,命令输出结果用$()来赋给变量,注意awk的写法
pid=$(ps -ef | grep java | grep ${APP_NAME}| awk '{print $2}')
# 注意如何判断变量为空
if [ ${pid} ]
then # then需要另起一行，与if在同一行时需要在then前加分号
    echo "stop ${APP_NAME}_${SERVER_PORT} service"
    echo "kill process ${pid}"
    kill -9 ${pid}
fi

echo "start ${APP_NAME}_${SERVER_PORT} service"
JAVA_OPTS="-Dspring.profiles.active=${SPRING_PROFILE}"
# 直接jar包报cannot access jar file错误
nohup java -jar ${JAVA_OPTS} ${JAR_HOME}/${APP_NAME}-${VERSION}.jar >${LOG_HOME}/${LOG_NAME}.out 2>&1 &

echo "tail -f ${LOG_HOME}/${LOG_NAME}.out"
```

## Mac parallel安装centos虚拟机
1. 下载centos最小安装镜像,我选择的版本是CentOS-7-x86_64-Minimal-1810.iso
官网地址: [centos下载](https://www.centos.org/download/)

2. 一步步安装，登录后发现命令界面太小，网上搜索后没有解决办法，突然想到可以用远程ssh
登录，自己装的iterm2已经非常美观实用了。
已找到方法：[修改centos分辨率](https://superuser.com/questions/816528/with-centos-7-as-a-virtualbox-guest-on-a-mac-host-how-can-i-change-the-screen-r)
```txt
$ sudo su
$ vi /etc/default/grub 
add vga=792 to the end of GRUB_CMDLINE_LINUX
$ grub2-mkconfig -o /boot/grub2/grub.cfg
$ reboot
```

3. centos开通root远程ssh访问权限
```txt
$ ssh -V    # 查看ssh 版本
$ vi /etc/ssh/sshd_config 
将配置中的 #PermitRootLogin yes 这一行前面的＃号去掉
$ service sshd restart  # 重启ssh服务
$ ip addr   # 查看ip地址，eth0中的inet值即是

本地mac iterm2 登录ssh
$ ssh -l tao 10.211.55.9
输入密码链接成功！
```
4. centos关机命令
`sudo shutdown 0`

5. iterm2配置自动登录ssh
网上说的是配置profile,但启动还需要定义快捷键，可以直接定义别名

6. 用item2登录后发现centos界面颜色与真实的一致，所以还是需要修改centos上自带的颜色
```txt
$ cp /etc/DIR_COLORS ~/.dir_colors
vim ~/.dir_colors
第59行：DIR 01;34（01：粗体，34：蓝色）
修改为：DIR 01;33（01：粗体，33：黄色）
```
## 老mac安装Ubantu
昨天在新mac上用parallel成功安装了centos虚拟机，想到我那个小的mid-2011的macbook air,
突然萌生了要改装linux系统的想法，马上google搜索一番，发现果然有人在网上说可以这样干，
因为老mac带不动最新的macOs系统，却可以带动最新的linux系统，但linux系统版本众多，选择
哪一个版本也是问题，google上有人测评过，说还是ubantu靠谱,所以就决定装它了!
具体安装过程参考这篇文章：
[try out linux on aging mac](https://www.imore.com/how-try-out-linux-aging-mac)

具体安装过程就按这篇文章进行即可，找个u盘用软件Ether做成系统光盘，然后在老mac上启动时
按option键选择install ubantu即可。
安装过程中可以先不连wifi，语言可以选英文，选中文的话会出现中文目录。

ubantu下载软件比较慢，可以换成阿里云的源，不同版本的ubantu源也不一样，
我装的是最新的LTS版18.04。
   1. 备份原来的源文件
   sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak
   2. 安装vim
   sudo apt-get install vim
   3. 编辑源文件
   sudo vim /etc/apt/sources.list
   4. 可以全部删除原来的，新增以下内容
```txt
deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse
```
  
   5. 更新软件列表
    sudo apt-get update
   6. 更新软件包
   sudo apt-get upgrade

   7. 其中系统的复制粘贴命令同windows，ctrl+c,ctrl+v。终端(ctrl + option + t)中的复制粘贴
   可以从preference中看出，复制ctrl+shift+c,粘贴ctrl+shift+v.

   8. 安装蓝灯，github上有ubantu版

   9. 安装google浏览器。
      1. 在ubantu中访问[google官网](https://www.google.com/chrome/),
   点击下载会自动出现linux版，下载到Downloads下面。
      2. 终端中执行：
      > dpkg -i google-chrome-stable_current_amd64.deb

      3. 网上说可能报错，需要按提示的命令执行apt-get -f install,我这边没有报错，直接按
      command键输入google，愉快的打开并登陆了！
   10. 使用vim经常要用到esc键，所以我习惯将capslock与esc键交换位置
   tweak-tool的工具。
   > sudo apt-get install gnome-tweak-tool -y && gnome-tweak-tool

   装好后有一个tweaks应用，在keyboard&Mouse>additional layout>capslock behavior>
   swap esc and capslock

   11. 完全卸载ubantu里的软件
```txt
apt-get purge / apt-get --purge remove 
删除已安装包（不保留配置文件)。如软件包a，依赖软件包b，则执行该命令会删除a，
而且不保留配置文件

apt-get autoremove 
删除为了满足依赖而安装的，但现在不再需要的软件包（包括已安装包），保留配置文件。

apt-get remove 
删除已安装的软件包（保留配置文件），不会删除依赖软件包，且保留配置文件。

apt-get autoclean 
APT的底层包是dpkg, 而dpkg 安装Package时, 会将 *.deb 放在 /var/cache/apt/archives/中，
apt-get autoclean 只会删除 /var/cache/apt/archives/ 已经过期的deb。

apt-get clean 
使用 apt-get clean 会将 /var/cache/apt/archives/ 的 所有 deb 删掉，可以理解为 
rm /var/cache/apt/archives/*.deb。

实际使用：
# 删除软件及其配置文件
apt-get --purge remove <package>
# 删除没用的依赖包
apt-get autoremove <package>
```

   12. gnome用上面的gnome-tweak-tool软件可以成功，但后面又看到阮一峰推荐的fish+Xfce+
   xmonad+vim的工作套件，尤其是xmonad窗口管理工具简直是分屏利器，于是把我的老mac也整
   这样一套。
     1. ubantu上安装xfce桌面，登录时可以选择桌面系统，ubantu(gnome)或xfce(更轻更快)
     > sudo apt install xfce4  #xfce最新的为2015年的4.2版本

     2. 交换xfce中的esc和capslock键，新建文件~/.Xmodmap,其中内容为
```txt
clear Lock
keysym Caps_Lock = Escape
keysym Escape = Caps_Lock
add Lock = Caps_Lock
```
    3. 重启后修改也生效！蓝灯和google浏览器也能访问之前安装的程序。
    注：xfce下之前测了可以，但在ubantu默认的gnome3下该交换重启后又不行了，gnome3下重启后
    仍生效的是执行下面这个命令，使用gnome3默认安装的dconf工具：
    > dconf write "/org/gnome/desktop/input-sources/xkb-options" "['caps:swapescape']"

2019-09-05 14:41:45 添加:
xfce中一直使用上面的xmodmap配置文件来交换esc和capslock键，但最近总失灵，
需要重新执行xmodmap文件，并且开启新的窗口报错。
在网上又找到个方案，目前看可以使用，没有报错，步骤记录如下:
```txt
1. 删除上面的.XmodMap文件，不然无效
2. vi /usr/share/X11/xkb/rules/base.lst
3. 搜索esc, 找到交换capslock和esc的配置项`caps:swapescape`.
4. sudo vi /etc/default/keyboard 
5. 修改为XKBOPTIONS="caps:swapescape"
6. sudo dpkg-reconfigure keyboard-configuration
7. 我选择了general 104 key and us layout, 最后确定保留配置
8. 重启电脑生效
```
 2019-10-23 16:32:17添加:
最近写racket要写很多括号，装了几个插件，并将`[`和`(`在vim中进行了交换(具体配置见以上vimrc配置),
发现如果软件层面上搞不定快捷键，可以买那些人体工学键盘(通常比较贵)来从硬件层面解决，如果
能从软件层面解决就更好，因为这样不用局限在某一块或某一类键盘上，不过人的"局限性"太大了，如
有再多钱只能睡一张床，只能开一辆车一样，我们也通常只能敲1,2块键盘，软件上的设置也是一种
局限，只不过它的移动性要比硬件更强，更新换代也更方便。

Anyway, 除了上面vim中的配置，简单的交换capslock和esc个人觉的还不够，可以将capslock再加上
ctrl的功能----右边的ctrl键正式宣布废弃使用! xkb对于x窗口是个神器！还可以切换qwerty成dvorak,
colemak等其他布局。以后有时间可以玩玩。同理对于单独按下modifier修饰键映射成其他键的功能是
xcape.
```txt
1. 将上面修改的/etc/defaul/keyboard中的XKBOPTION改为'caps:ctrl_modifier'。
2. sudo apt install xcape
3. 新建~/.xprofile文件，加入
/usr/bin/xcape -e 'Caps_Lock=Escape'
4. 重启(前面改了xkb设置，必须重启)
```
 2019-10-24 10:01:43 添加:
上面的配置是可以的，但ctrl键其实用的较少，因为我使用xmonad, modMask键是super键，所以通常
来说super要比ctrl用的多，所以我提出了以下的配置目标:
```txt
1. capslock键单独按是esc, 长按是super键。(大写常开功能就不要了).
2. left shift 是切换fcitx中英文输入法 (esc, left_control, left_super 都不动) 
3. right shift单独按是左括号(xcape实现) 
4. space单独按时是空格键不变，长按时是ctrl键。(xcape实现)
```
注: 可以用xev命令查看对应键的keycode.
实现步骤:
```txt
1. 修改capslock:
   /etc/defaul/keyboard改为:(主要是XKBOPTIONS项，也可以使用setxkbmap命令放在.bashrc中实现)
     BACKSPACE="guess"
     XKBMODEL="pc104"
     XKBLAYOUT="us"
     XKBVARIANT=""
     XKBOPTIONS="caps:super"
  通过xev发现它映射为左边的super键，因为~/.xprofile发现重启后没有生效，所以放到.bashrc中,
  我是.bash_aliases:
     # Run xcape once.
     if [ -z $XCAPE ] ; then
     export XCAPE=1
     /usr/bin/xcape -e 'Super_L=Escape' 
     fi
  重启电脑后即可发现caslock修改成功！控制xmonad和作为esc很方便。
  注: 上面的方法有问题，打开多个终端窗口时有多个括号，具体原因见本博客LinuxNote.
  可以放在.bash_profile中，启动时执行一次`. ~/.bash_profile`, 还未找到启动执行命令的方法。
  或者不用变量，使用ps -ef 查找进程，如果有，就不执行，代码还是放在.bashrc中——这只是暂时
  的办法，按理说不应当每次打开终端都要进行判断。

  再注: 经过查找资料和多次尝试，终于找到了解决方法！
  1. 自定义的环境变量若想使用全部用户，放在/etc/profile.d/下的新建脚本中，使用export导出
  xmonad也能看到。
  2. 环境变量和命令针对X11独有的配置可以放到.xsessionrc下。xcape命令直接放入即可，不需要
  上面的环境变量判断，因为.xsessionrc只会在启动时执行一次！

  经过测试发现，ubuntu wayland登录时不会执行.xsessionrc文件。gnome有自己的启动项设置
  gnome-session-properties.

2. fcitx配置同以上记录，不要修改，中英文切换对于写博客来说太常用了....
3. 这一步在mac系统上使用karabiner很方便就实现了。今天发现xcape提供了类似的功能，还是非常
强大的，windows系统可以使用autoHotKey.
    将以上的xcape命令改为如下即可:
      /usr/bin/xcape -e 'Super_L=Escape;Shift_R=parenleft' 
  注: 经测试，启动后直接按capslock并没有生效，按下右shift有效，再回来按capslock就生效了，
  估计和xcape执行顺序有关。

4. `man xcape`上的例子，之前也有说用回车键的，但还是远了点，空格键不错.
试着像上面一样将命令直接放到.xsessionrc中，但是没有生效，网上查找资料猜测是由于.xsessionrc
很早就被加载执行，其中的xmodmap命令无效，所以我将相关代码全部提取出来单独作为一个脚本，
重启后手动执行，所有改的键都生效了！只是这样同前面的问题一样，不能执行多次该脚本，否则
会出现多个括号。
注: 在.xsessonrc中执行该脚本. /home/tao/key.sh &, key.sh中先sleep 20(睡20秒),重启改键生效！
不用手动执行了！
```
注: 由于右边的shift键与回车键较远，所以暂时先将fcitx的中英输入法切换为右shift, 左括号键
改为左shift, 正好练练右shift键，要知道写博客时中英输入法是切换的非常多的。


由于fcitx(还有中英文自动切换输入的vim插件)是使用左shift键进行切换的，当我上面的options中
加入`, shift:both_capslock_cancel`(将左右shift键同时按变为capslock功能)时，fcitx无法正常
工作。所以只好暂时放弃大写功能，可以使用vim的~键统一转或gU。
注: fcitx之前也折腾了很久......, 这里记录下双拼的按键配置，防止再出问题...:
```txt
global config
Trigger input method: Lshift empty (操作时可以用escape变为empty)
extra key for trigger input method: L_shift
enable hotkey to scroll.... non-check
scroll between input method: ctrl+shift
prev-page: - up
next-page: = down
```
 2019-10-28 11:50:09 添加:
ubuntu用以上工具xcape，xkb改键后，其中的win10虚拟机中没有生效，有奇怪的问题，如右边的shift
键变为了数字9，anyway, 我只需要`caslock->escape`, `space->ctrl modifier`这2大核心功能就行，
括号除了lisp其他时候也用的少(这里我倒是可以双shift), 下面记录下使用AutoKey实现这2个功能
的脚本:
```txt
Capslock::Esc
*Space::
{
  SendInput, {Ctrl Down}
  Key =
      Input, Key, V L1
      Return
}
*Space Up::
{
  SendInput, {Ctrl Up}
  Input,,T.01
      If !Key
      {
          If (A_TimeSincePriorHotkey < 300)
          {
              SendInput, %A_Space%
          }
      }
  Return
}             
```
 2020-06-02 14:06:19 add:
**Now it's the end of this whole keyboard config**
due to pursuit of emacs meta key, I succeed to own ctrl, super, meta, alt keys work
perfectly together!
1. capslock -> escape alone and left control when pressed
2. left control acts like left meta, now in terminal ctrl + e/v can jump to temp editor,
and emacs use!
3. left alt is still alt, can control st rolll up/down and size up/down perfectly and other
usages, like listary in windows.

all of the above functions only need one script, key.sh(work in X11)
```txt
#!/bin/sh
# to be executed from .xsessionrc

# make xkb take effect first, or .xsessionrc executing too early
sleep 3

setxkbmap -option caps:none -option caps:ctrl_modifier -option ctrl:lctrl_meta

killall xcape 2>/dev/null
xcape -e "Shift_L=parenleft;Caps_Lock=Escape" 

# make h,j,k,j move faster
xset r rate 300 50
```
workman layout switch shortcuts:
```txt
// fish shell 
alias workman "bash -c 'setxkbmap -v workman-p && xset r 66'"
alias us "bash -c 'setxkbmap us; xset -r 66'"
```
by the above config, we can toggle between different layouts, but how can we input
chinese? 
in fcitx, we can change the english input layout to workman, solved!
As we can notice, xiaohe shuangping symbols is bind to specific keys, so we can actually
use workman layout to input xiaohe shuangping chinese!

wonder what need to be configed in emacs to use evil to input chinese.



linux下的pdf编辑工具，使用libreOffice Draw进行编辑，可以下载pdfshuffler来进行删除和
合并pdf操作。经测试重组的pdf仍然会有些小问题，还是可以看，有问题再对照原版吧。

    4. 安装fish shell.
    > sudo apt-get install fish
    > fish  #启动shell,不建议设置为默认shell

    5. 安装xmonad
    > sudo apt-get install xmonad
    > sudo apt-get install xmobar dmenu  #小工具

    安装完之后只logout发现没有xmonad桌面，重启后才出来那个全黑的界面，果断alt+shift+enter,
    当当！终端出来了，vim看看capslock和esc也已经交换了，证明了它确实只是一个窗口管理软件，
    至此，fish+xfce+xmonad+vim的一套已经搞定，具体使用和问题后面再写，今天到点睡觉了！
    -- 2019-03-31 23:00:21 

    xmonad下蓝灯无效果，而且中文输入法也出不来，只能暂时放弃，等以后有需求和时间再来折腾
    一下。


   13. 安装fcitx来使用小鹤双拼，以及vim中输入中文输入的插件
```txt
sudo apt install fcitx
sudo apt install fcitx-pinyin
fcitx
在桌面图标上选择config current input method
为配合插件使用，第一位选择keyboard-English,第一个加上Shuangpin,
这里加上以后默认的不是小鹤双拼，需要修改默认双拼方案
cd ~/.config/fcitx/conf
vi fcitx-pinyin.config
设置为DefaultShuangpinSchema=XiaoHe
```
另: fcitx输入中文变繁体，按ctrl + shift + f变回简体输出。

   14. 在ubantu系统启动时执行某些命令，如`sudo tlp start`软件减少散热的，还有命令别名
   设置等，之前放到.bash_profile中不行，网上搜索到可以放在.bashrc中，查看.bashrc文件，发现
   它有检查.bash_aliases文件，于是新建该文件，将命令放入其中即可。

   15. shell基本使用

      1. 不建议设置为默认shell,在.bashrc或.bash_aliases中写入`exec fish`来实现启动终端时
      执行fish。

---
      2019-10-25 14:34:17 添加: 
    由于.bashrc会在执行bash命令中自动执行(包括执行命令'bash'和打开新终端实例), 所以达不到
    bash和shell自由切换的效果，这里找到了一种方法可以切换。
```txt
在terminator的profile->commnad中选中run a custom command instead of my shell, 写入fish,
后面的when command exits, 选择exit the terminal.
```
这样，打开新终端实例时，自动进入fish, 输入命令`bash`即可切换到bash, 非常方便！
---

      2. 执行命令`fish_config`进入网页配置界面，默认8000端口打开的本地网页，可以设置颜色
      主题和提示符prompt等。
      3. 自定义别名
      ```txt
 alias post 'cd /home/tao/wtt/blog/source/_posts'
 funcsave post     #可以在.config/fish/config.fish/functions下找到生成的fish文件
 alias pull 'git pull; and echo "done"'
 funcsave pull
 alias push 'git add . ;and git commit -m $argv[1];and git push origin source; and echo "done"'
 funcsave push
 alias pub 'git push github source;and echo "done"'
 funcsave pub
      ```
  2019-08-16 15:41:06 添加:
Linux下使用sdcv作为终端查单词非常方便，直接使用sudo apt install sdcv即可安装，其中词典
需要自己下载，google一个星际译王的网站，里面有大量词典。其中有些字典在终端下排版格式不
好看，无法阅读，只能放弃。
目前本人使用的字典有(排序分先后):
Collins Thesaurus (En-En)
Concise Oxford English Dictionary (En-En)
Oxford Advanced Learner's Dictionary 8th Ed.
Cambridge Advanced Learners Dictionary 3th Ed. (En-En)

通过man sdcv查看相关命令配置等。fish的别名使用上面的alias命令无法生效，报错找不到文件，直接
写function然后保存反倒是成功了，说明了function的适用性更强一点。
 2020-09-29 11:22:05 add:
function fw
        command sdcv $argv[1] | less
end

 2019-08-21 09:38:15 添加:
在写博客的过程中如果要使用命令行查单词，需要先退出vim编辑器，比较麻烦，可以使用linux
命令ctrl+z将当前任务暂时挂起并停止运行，查询完单词后使用fg命令将挂起命令恢复到前台。

 2019-10-26 07:32:15 添加:
去除fish shell欢迎语: `set fish_greeting`.

   16. vim中输入中文的插件，实现插入模式中自动切换为中文，leave insertMode时切换为英文，
   按教程安装vundle,plugin有
  ```txt
Plugin 'scrooloose/nerdtree'
Plugin 'lilydjwg/fcitx.vim'
  ```
  fcitx.vim针对的是fcitx下的中文输入，其脚本中也是切换键盘输入，所以前面设置fcitx时需要
  将第一位设置为英文，第二位设置为双拼。其插件脚本为
```txt
"##### auto fcitx  ###########
let g:input_toggle = 1
function! Fcitx2en()
   let s:input_status = system("fcitx-remote")
   if s:input_status == 2
      let g:input_toggle = 1
      let l:a = system("fcitx-remote -c")
   endif
endfunction

function! Fcitx2zh()
   let s:input_status = system("fcitx-remote")
   if s:input_status != 2 && g:input_toggle == 1
      let l:a = system("fcitx-remote -o")
      let g:input_toggle = 0
   endif
endfunction

set ttimeoutlen=150
"退出插入模式
autocmd InsertLeave * call Fcitx2en()
"进入插入模式
autocmd InsertEnter * call Fcitx2zh()
"##### auto fcitx end ######
```

## ubantu下vim的粘贴复制问题
昨天使用ubantu默认的gnome-teminal时，发现多个tab间无法进行复制粘贴操作，经网上搜索发现
以前gnome-terminal确实有这个bug,但是后来已经修复了，回到家用自己电脑下了一个terminator
来替代gnome-terminal，发现还是有这个问题。本来已经放弃了，但是今天无意中搜索到原来是vim的
问题，原生的vim不能与系统剪切板进行交互，需要下载vim-gnome！
```txt
sudo apt --purge remove vim
sudo apt install vim-gnome
```

OK!将原来的.vimrc中
```txt
#set clipboard+=unnamed
noremap <Leader>y "+y
noremap <Leader>v "+p
noremap <Leader>V "+P
```

## ubantu下vmware虚拟机网络设置问题
终于这个困扰本人许久的问题终于正式解决了！
首先看一下引发解决的关键点：
1. vmware workstation的editor->virtual network editor
2. bridge,nat,host等概念
3. 有限网络的默认网关屏蔽

首先介绍一下操作背景，银行通过有线网线来链接内网，平时查资料需要通过个人热点来链接外网，
同时因本人喜欢终端命令行操作及vim编辑等功能，打算放弃windows操作系统，但银行内部需要
windows来进行工作，所以是重装了ThinkPad T540P笔记本为ubantu LTS 18.04系统，安装了
linux版的vmware workstation,其中安装了用于工作的windows10系统————这就是操作环境。

1. 插上网线和链接上个人热点后，通过`ip route show`看到有两个默认网关，链接外网失败。
在网络设置中-wired connected-settings-ipv4中，先关闭链接，再勾选
use this connection only for resources on its network
再链接后，可以发现默认网关只有一个热点了，此时可以上外网。

2. 配置vmware workstation的网络设置，在editor->virtual network editor中进行配置，可以
选择对应的网卡。
```txt
Bridge mode:This connects the virtual network adapter directly to the physical network
NAT: This allows the virtual network adapter to share the host’s IP address
Host Only: This creates a private network that the virtual network adapter shares with the host
Custom: This allows you to create your own virtual network

Note: Although VMnet0, VMnet1 and VMnet8 are technically available in this menu, 
they are usually used for bridged, host-only, and NAT configurations, respectively.
```
由以上概念可知，这里实际需要的就只是桥接模式，直接接入物理网络，nat模式选择时还需要进行
手动网络转换，而且之前使用也达不到目地，就不选这个了，host模式只能宿主机访问，也不满足要求。
这里为避开0,1,8的默认名字，可以取名VMnet11,12代表有线和无线2个网卡。

3. 为工作的虚拟机配置里选择网络设置为custom，选择刚才新建的虚拟有限网卡，为自己玩的
centos配置虚拟无线网卡。

4. 登录工作虚拟机，发现链接内网成功！

5. 登录centos7,这里时新建的minimal安装，执行以下命令：
```txt
cd /etc/sysconfig/network-scripts/
ip addr // 查看除了lo外的另一个网卡名字如ens33
su root  // enter password
vi ifcfg-ens33
onboot=no 改为 yes
systemctl restart network
ping www.baidu.com   // done!
```

## ubantu修改swap文件
```txt
sudo swapoff /swapfile
sudo rm -rf /swapfile
sudo fallocate -l 2G /swapfile
 # sudo dd if=/dev/zero of=/swapfile bs=1024 count=2000000  #建立swap文件2G
sudo chmod 600 /swapfile     
sudo mkswap /swapfile    #创建系统
sudo swapon /swapfile   # 开启swap
sudo vi /etc/fstab
/swapfile swap swap defaults 0 0
free -h  # check swap size
```
## ubantu备份和还原
终于完美从thinkpad迁移到mac的虚拟机上！
1. 备份老系统
由于我是默认用的fish,所以为防止报错，写了一个bash shell脚本来执行打包命令
```txt
vi bashShell.sh

内容如下
#!/bin/bash
tar cvpzf /media/tao/ExFAT/backup.tgz --exclude=/media/* --exclude=/sys/* 
--exclude=/proc/* --exclude=/dev/* --exclude=/run/* --exclude=/snap/* 
--exclude=/home/tao/vmware/* 
--exclude=/home/tao/Documents/CentOS-7-x86_64-DVD-1804.iso /

sudo su
chmod +x bashShell.sh
sudo ./bashShell.sh
```

2.如果是原来机子回复系统，可以这样做（未测试）
```txt
cd /
sudo su
sudo tar -xvpzf /media/tao/ExFAT/backup.tgz -C /
sudo reboot 0
```
done!
注： tar命令只会覆盖已有的文件，备份后新增的文件不会修改或删除。

3.如果是虚拟机或其他电脑，因为硬盘的uuid不同，所以需要多些步骤
由于我的移动硬盘是exfat格式，所以需要给ubantu安装exfat-utils:
```txt
更新数据源为阿里云，
sudo apt update
sudo apt install exfat-utils
插上u盘后，始终无法识别，这里还要将vmware虚拟机设置下硬件，
改为usb 3.0接口

备份fstab,得到其中的uuid
cd ~
mkdir back
cd /etc/
sudo cp fsta ~/back
备份grub.cfg
sudo cp /boot/grub/grub.cfg ~/back

恢复旧系统备份
cd /
sudo su
sudo tar -xvpzf /media/tao/ExFAT/backup.tgz -C /

回复fstab和grub
sudo cp ~/back/fstab /etc/
sudo cp ~/back/grub.cfg /boot/grub/

重启
sudo reboot 0
```
done!
 
4. 卸载ubantu虚拟机上的vmware-workstation软件
sudo ./VMware-Workstation-Full-15.0.3-12422535.x86_64.bundle -u vmware-workstation

 2019-10-15 17:27:07 添加, 备份系统其实应该用rsync命令，rsync用于拷贝不同的文件到目的文件夹
 下，非常适合用于在以前备份的基础上进行更新备份包。
```txt
// -a: archive mode, same as -rlptgoD 基本是递归保存文件的信息 
// v verbose z compress mode 传输过程中使用
// 压缩文件形式，适合远程备份， -P progress显示进度条
rsync -avzP -f 'exclude *.db' source destination
// 本地备份到移动硬盘时可以不用压缩
rsync -avP -f 'exclude *.db' source destination
```

## vmware workstation上修改ubantu分辨率
27寸的HKC屏幕最佳分辨率是2560X1440,ubantu虚拟机给出的最大分辨率是2560X1600,网上找到可以
修改的方案，记录如下：
```txt
xrandr   # 得到第二行的第一个单词，connected primary前的单词为显示设备名称Virtual1

cvt 2560 1440   # 输入需要的分辨率
# 得到一行modeline
# Modeline "2560x1440_60.00"  312.25  2560 2752 3024 3488  1440 1443 1448 1493 -hsync +vsync

# 添加新mode, --newmode后为前面的modeline
sudo xrandr --newmode "2560x1440_60.00"  312.25  2560 2752 3024 3488  1440 1443 1448 1493 -hsync +vsync

# 将新模式应用到显示设备中,设备名和分辨率分别取前面的值
sudo xrandr --addmode Virtual1 "2560x1440_60.00"

# 在settings->resolution中可以看到需要的分辨率了，apply即可成功！

# 编辑～/.profile使ubantu下次以这个分辨率启动
加入上面2行命令
sudo xrandr --newmode "2560x1440_60.00"  312.25  2560 2752 3024 3488  1440 1443 1448 1493 -hsync +vsync
sudo xrandr --addmode Virtual1 "2560x1440_60.00"
```
注！按以上配置，重新登录后黑屏，只好在登录界面按ctrl+alt+F3进入命令登录界面，
删除刚才修改的~/.profile文件。
具体原因明天再看吧！

## xmonad
折腾了一晚上，成功的搞出了背景图片，浏览器里可以输入中文(fcitx),双屏切换alt+w,r操作前先
在大屏上最大化再扩展小屏也能正常使用，但是！vim里面fcitx又出不来了，终于放弃，后来又发现
ubantu gnome也支持双屏操作的快捷键，主要是以下4个快捷键
```txt
alt + tab  切换应用
alt + esc(我改成capslock)  切换上下屏幕
command + shift + up/down  将当前窗口移动到上面的屏幕或下面的屏幕中
```
就这样吧，太喜欢折腾也不好，还是不能为了工具太折腾，明天赶紧装下idea, 正常写代码和锻炼！

 2019-04-21 22:01:59
 注: 说不折腾，但还是又搞了几天，终于搞出来了，也算行吧。
 ubantu上直接安装xmonad，按教程走到最后，发现在终端里始终不能输入中文，但浏览器里可以，
这个问题卡了蛮久，当时想的是终端的问题，但没有实践，后来又转到mac下去实现xmonad了，不过
最近又实践了一下，发现成功了！mac也成功了！双喜临门！记录如下：

1. ubantu 18.04下安装xmonad
主要是参照教程[https://beginners-guide-to-xmonad.readthedocs.io/intro.html](https://beginners-guide-to-xmonad.readthedocs.io/intro.html),
我自己修改的地方就是改动了最后的启动文件.xsessionrc

```txt
#!/bin/bash

# Load resources

xrdb -merge .Xresources

# Set up an icon tray
stalonetray &

# Fire up apps

xscreensaver -no-splash &

if [ -x /usr/bin/nm-applet ] ; then
   nm-applet --sm-disable &
fi

fcitx &
xmodmap ~/.Xmodmap &
feh --bg-scale ~/back.jpg &
# 虚拟机内使用 vmware-tool
vmware-user &

export GTK_IM_MODULE=fcitx
export QT_IM_MODULE=fcitx
export XMODIFIERS=@im=fcitx

exec xmonad
```
可以看到我加了输入法fcitx,esc和capslock键的交换，背景图片以及fcitx的环境变量配置
其中.Xmodmap文件内容上文有提到，这里掠过。

最后，替换掉gnome-terminal发现可以正常使用fcitx输入法，
sudo apt install terminator
sudo update-alternatives --config x-terminal-emulator
选择terminator，输入其编号即可

Done!
xmonad官网上有与gnome整合的文章，没有细看，这里配好了就不需要它了，
[https://xmonad.org/documentation.html](https://xmonad.org/documentation.html)
最下面一排小字！
ubantu上还有问题就是vmware-tool的复制粘贴功能没有了，gnome下可以实现，还需要再整整，
to be continued......

 2019-04-22 21:14:57 solved:
 google上搜到了vmware-tools-user-guide官方文档，可以手动启动vmware user process进程，
 在.xsessionrc中加入一行： `vmware-user &`
 Done!
 另：上班时发现电脑自动关机了，后来发现是电池没有电了，xmonad没有低电量警告！
 网上搜到一个python程序rcoh/batmon

```txt
sudo apt install python-pip
pip install batmon
ls /sys/class/power_supply/   #BAT0或其他数字
vi ~/.xsessionrc # 添加
batmon BAT0 &
```

 2019-04-23 21:46:57 注：
 在thinkpad上使用了无效果，发现notify-send命令在xmonad下无效,


当时也是在那发现了
mac上安装xmonad的方法，根据这个又整了一个周末。 
[https://wiki.haskell.org/Xmonad/Using_xmonad_on_Apple_OSX](https://wiki.haskell.org/Xmonad/Using_xmonad_on_Apple_OSX)
这篇太简略了，还参照了这篇[my xmonad recipe for macOS](https://gist.github.com/danchoi/3923233)

我自己的步骤为
1. 下载XQuartz,并按recipe里设置好
2. 下载haskell-platform macOS 64位安装包(brew安装太慢，问题太多了...)
3. 在文章里找到这个[https://github.com/xmonad/X11/issues/24](https://github.com/xmonad/X11/issues/24),使用命令
LIBRARY_PATH=/opt/X11/lib:$LIBRARY_PATH cabal install xmonad
4. 按wiki.haskell里新建~/.xinitrc/90-xmonad.shell，但xmonad并没有生效，USERVM中的路径用
命令`which xmonad`并没有输出，也搜索了很久和重装xmonad后，在~/.cabal/config中发现说要在
.bash_profile中加入path变量，加入后，`which xmonad`即成功输出为文档中的值。
5. 启动XQuartz,设置成全屏模式，并按alt+shift+enter,可以发现xmonad成功启动了！
但它还不支持多屏...
to be continued
 2019-04-22 22:55:55 注：
 今天又试了下，发现XQuartz在全屏模式下是支持多屏的，用xmonad的mod+w,e可以正常切换屏幕，
 明天再试着调用app,改造终端样式等。
 2019-04-23 21:44:56
 看到一篇日语文章，和我之前整的过程差不多，它最后也是推荐Amethyst,想想mac上xmonad也就整到
 这里了。

 2019-04-26 18:39:10
 今天解决了2个在实际使用ubantu,xmonad,lantern的问题
 1. xmonad下无电池低电量预警
 xmonad-contrib里之前收到有一个urgency插件，但配置比较麻烦，也许可以使得notify-send命令
 产生效果，但一直没试。今天搜到可以让有电池信息的xmobar在xmonad全屏模式下显示出来，具体
 是修改.xmobarrc文件
```txt
Config { font = "-*-Fixed-Bold-R-Normal-*-13-*-*-*-*-*-*-*"
        , borderColor = "black"
        , border = TopB
        , bgColor = "black"
        , fgColor = "grey"
        , position = TopW L 100
        , persistent = True     # wtt-add
        , overrideRedirect = False  # wtt-add
        , commands = [ Run Weather "ZUUU" ["-t","<tempC>C","-L","18","-H","25","--normal","green","--high","red","--low","lightblue"] 36000
        , Run Battery [ "--template" , "Batt: <acstatus>"
               , "--Low"      , "10"        -- units: %
               , "--High"     , "80"        -- units: %
               , "--low"      , "darkred"
               , "--normal"   , "darkorange"
               , "--high"     , "darkgreen"
               , "--" -- battery specific options
                      -- discharging status
               , "-o"	, "<left>% (<timeleft>)"
                      -- AC "on" status
               , "-O"	, "<fc=#dAA520>Charging</fc>"
                      -- charged status
               , "-i"	, "<fc=#006000>Charged</fc>"
             ] 50
                        , Run Network "eth0" ["-L","0","-H","32","--normal","green","--high","red"] 10
                        , Run Network "eth1" ["-L","0","-H","32","--normal","green","--high","red"] 10
                        , Run Cpu ["-L","3","-H","50","--normal","green","--high","red"] 10
                        , Run Memory ["-t","Mem: <usedratio>%"] 10
                        , Run Swap [] 10
                        , Run Com "uname" ["-s","-r"] "" 36000
                        , Run Date "%a %b %_d %Y %H:%M:%S" "date" 10
                        , Run StdinReader
                        ]
        , sepChar = "%"
        , alignSep = "}{"
        , template = "%StdinReader% | %cpu% | %memory% * %swap% | %eth0% - %eth1% | %ZUUU% | %battery% }{<fc=#ee9a00>%date%</fc>  | %uname% "
        }
```
这样配了之后，打开需要的google,vmware,terminal，需要重启xmonad才能看到xmobar，目前只能这样
了:执行命令`xmonad --restart`。

2. xmonad和KDE,XFCE下lantern可链接但无法访问google问题，此前只有在gnome下lantern才能正常
使用。今天搜索如何在linux下设置代理找到了配置方法，成功在xmonad下正常使用xmonad。
```txt
sudo vi /etc/environment

添加
all_proxy=socks://127.0.0.1:43359/
ALL_PROXY=socks://127.0.0.1:43359/
http_proxy=http://127.0.0.1:43359
HTTP_PROXY=http://127.0.0.1:43359
ftp_proxy=http://127.0.0.1:43359
FTP_PROXY=http://127.0.0.1:43359
https_proxy=http://127.0.0.1:43359
HTTPS_PROXY=http://127.0.0.1:43359

新建配置文件，这个应该是针对apt的代理设置
vi /etc/apt/apt.conf 

Acquire::http::proxy "http://127.0.0.1:43359/";
Acquire::ftp::proxy "ftp://127.0.0.1:43359/";
Acquire::https::proxy "https://127.0.0.1:43359/";
使用命令来校验
apt-config dump  | grep -i proxy
```

之前突然看到有linux上的fliqlo屏保，叫gluqlo,今天在xmonad上成功安装。
1. 因为之前装xmonad时已经安装了xscreensave,所以把另外2个包也下载下，主要是各种屏保文件。
sudo apt remove gnome-screensaver # 这步没有执行
sudo apt install xscreensaver-gl-extra xscreensaver-data-extra

下载gluqlo
sudo apt-add-repository ppa:alexanderk23/ppa
sudo apt-get update
sudo apt-get install gluqlo

看了xscreensaver manual,里面说设置直接执行以下命令即可
xscreensaver-demo
里面选择只展示一张，选中gluqlo即可。
主动激活屏保的命令
```txt
sleep 2; xscreensaver-command -activate
```
结合前面的重启xmonad命令，可以这样定义2个别名
```txt
alias rstX 'xmonad --restart'
funcsave resX
alias xlock 'sleep 1; xscreensaver-command -activate'
funcsave xlock
```

## xfce中使用vmware-workstation快捷键问题
由于xmonad没有很方便的提示电池电量的方法（不支持notify-send命令）,所以在经历了几次电池
耗尽自动关机后还是抛弃了xmonad,转向xfce,xfce也没有自带电池监控软件，但是可以
`sudo apt install xfce4-battery-plugin`插件，实际使用很方便，到设定的百分比时在虚拟机
全屏界面下也可以正常给出弹框提示。
 2019-08-22 16:19:45 添加:
xfce4桌面不能调节屏幕亮度，网上搜索到可以安装`sudo apt install xfce4-power-manager-plugins`,
可以实现鼠标拖动修改屏幕亮度，还有电池电量监控，所以可以不用安装上面的battery插件。

在实际使用虚拟机时发现一个快捷键问题，在ctrl+alt跳出虚拟机后，在不知情的情况下按下Idea
的快捷键ctrl+e来查看最近打开的文件，结果虚拟机关闭了！！！

原来vmware-workstation自带的快捷键有
ctrl + e  power off
ctrl + r  reset power 

主要是这2个大坑，其他快捷键没有多大影响。经网上搜索windows下可以用autohotkey来映射ctrl+e
到别的键上，mac可以用karabiner,linux可以用xmodmap,但具体xmodmap怎么配置组合按键没有搜到，
但对于xfce可以使用其自带的快捷键修改功能来完成。
终端下输入
`xfce4-settings-editor`进入键盘修改界面，
```txt
xfce4-keyboard-shortcuts -> commands/custom
-> new ->
property: /commands/custom/<Control>E
type: String
value: gedit或terminator等任意其他即可
-> close
Done!

同理可设置ctrl+r
```
 2019-05-10 11:27:34 注:
 实际使用时发现ctrl+r在vim中是默认的redo,按以上设置无法正常使用，所以保险的方法还是
 在跳转到虚拟机界面时按j或k,使用虚拟机的capture key功能来避免误操作。
 ctrl+e的设置可以保留。

## xfce4 截屏
需要安装截屏插件
`sudo apt install xfce4-screenshooter`
在applications->settings->keyboard->application shortcut中add
command:
xfce4-screenshooter -r
按键prt-sc定义快捷键，done!

## ubantu内核升级后回退版本
最近在系统中安装了sdcv方便查找单词，不自觉的按网上常规"要求"执行`sudo apt update`命令后
在乖乖执行`sudo apt upgrade`进行系统升级操作。结果上班发现vmware-workstation启动不起来，
报错`cannot build vmnet`, 经过多番尝试，发现可以回退内核版本，回退就可以正常工作了，所以
没事还是不能随便升级!尤其是在工作电脑上！

回退步骤:
1. 修改/etc/default/grub文件，将其中的`grub_timeout`值修改为3以上的数字。
2. 重启时按esc(EFI固件)进入grub页面，选择ubantu高级操作，选择需要回退的内核版本(不要选择
有其他后缀的版本，如rollback等)。
3. done!

## command line editor in fish shell
1. 发现可以用ssh远程登录自己的ubantu虚拟机来写博客，如果要在本地的mac上使用ubantu上的
zathura看pdf的话，还需要在mac上配置X11forwarding=yes, 并且启动Xquartz, 折腾了一下，mac
终端卡住没反应。想想还是觉得没必要，mac也有zathura的brew版本，不过毕竟zathura原本是linux
上的软件，移植过来性能或配置可能会有些问题(看其github的issue等), 还是用虚拟机本体看pdf吧。

2. mac的终端有些命令如ls和linux终端还是不一样的，还是不同流派的原因，所以也没有必要非要将
mac都改造成linux的功能, 如使用命令`brew install coreutils`等。我还是就使用虚拟机玩ubantu, 
RHEL等原生linux系统吧。

3. 在网上突然发现命令行上也可以使用vim，虽然之前在银行的服务器上看到过这样的效果，但以为
那是它自带的效果，今天发现原来它是命令行绑定的键盘映射。我们平时经常用的是默认的Emac模式，
如ctrl + a, ctrl + e跳到开始和结束位置等快捷键都是Emac的快捷键。因为我使用的shell是fish,
所以它修改为vim的命令行编辑器的命令为
```txt
# 切换为vim模式 -U universal 重启Shell后也生效
set -U fish_key_bindings fish_vi_key_bindings 

# 切换为默认的Emac模式
set -U fish_key_bindings fish_default_key_bindings  
```
vim模式在命令提示符前会给出当前模式的提示符，但是fish的自动补全功能快捷键ctrl+f在vim模式中
无法使用了。fish的github的issue中讨论了这个问题，说可以单独指定，但这样很可能vi的模式提示
符就没有了(fish document中还给出了一个`hybrid_bindings`方案，经测试可以使用，功能很强大，
可以同时使用Emacs和vim的快捷键，但还是没有模式提示), 经测试比较，还是决定直接使用vim模式，
需要补全的，按Esc跳到普通模式后使用w进行补全操作，也不是很麻烦.

 2019-10-18 15:01:25 添加:
 bash中在.bashrc或`.bash_profile`中添加`set -o vi`可以将bash命令设置vim模式，而不是默认的
 emac模式，其中在普通模式中按v不是进入选择模式，而是bash的内置fc命令的编辑器界面。
 bash中`fc --help`可以查看命令.通过help和网页上搜索相关资料，这个命令基本上没有什么用了，
 不如`history | grep xxx`好用，`fc -s xxx`不好用。

 (fish中没有fc命令，不过它在上下切换历史命令后按alt + e或
 alt + v可以进入fc一样的编辑命令编辑器中，第一次运行提示$VISUAL或$EDITOR变量没有设置，
 在.bashrc(我的是`.bash_aliases`)中添加`export EDITOR=/usr/bin/vim`后即可正常使用,
 fc中待编辑的命令即使不保存也会执行，可以使用vim自带的:cq以错误码形式退出即可).

注: bash中使用vi模式，插入模式和命令模式切换界面没有提示，可以在home目录下编辑.inputrc文件，
添加如下一行即可。
```txt
#set editing-mode vi    # 这2行由于我上面使用了set -o vi针对bash设置了模式，其他如mysql,
#set keymap vi-command  # git等终端界面可以使用这里的配置也使用vi模式输入(未测试)
set show-mode-in-prompt on
```
说是要bash 4.2以上

再注: fc命令最强大的地方即在于使用history查找需要的命令行数后(如123), 使用`fc 123`进行修改
后执行，不需要用鼠标选中修改! (不需要修改时直接!123即可)

终极解决方案: reverse-i-search
按ctrl+r, 再输入历史中的命令关键字即可，按ctrl+r进行切换。
fish中直接输入然后使用上/下(vim模式是j/k)键即可智能搜索。


## SSH to Vmware Fusion ubantu guest from mac 
1. ubantu上要安装ssh-server, 关闭防火墙。
2. 查看ip addr show查看ip地址, 之前用ip route show查看的default不是它的IP地址，下面的ens33
网卡的IP才是真实IP, 因为IP搞错了，搞得一晚上连不上也是无语了。
3. 确认是桥接模式的网卡适配器。
4. mac上直接使用`ssh tao@xxx.xxx.xx.xx`进行连接，输入密码后即可登录。

注: 可以将本地mac的SSH公钥传输到VM guest上，这样下次登录就不用输入密码了，命令为
`ssh-copy-id tao@xxx.xxx.xx.xx`.

再注: 使用mac SSH登录到虚拟机上时发现fcitx-vim的输入法切换插件无法使用了，估计它还是需要底层
的输入法控制，fcitx-vim插件作者在博客中有提到在不同linux主机间的ssh操作可以使用socat转发
套接字，不过mac就不行了。最后发现我之前的小工具博客中有记录具体的fcitx-vim-for-osx的操作
过程，配置成功！

## Xmonad Latest and Fullest config

---
[.xmonad/xmonad.hs github repo](https://github.com/wutaotao2015/tao_config_repo/blob/master/HOME/.xmonad/xmonad.hs)
---

---
[.xmobarrc github repo](https://github.com/wutaotao2015/tao_config_repo/blob/master/HOME/.xmobarrc)
---

---
[.stalonetrayrc github repo](https://github.com/wutaotao2015/tao_config_repo/blob/master/HOME/.stalonetrayrc)
---

---
[.xsessionrc github repo](https://github.com/wutaotao2015/tao_config_repo/blob/master/HOME/.xsessionrc)
---

for now, fcitx can't input shuangpin chinese...to be done.
2019-09-14 09:32:14 注:
发现fcitx在终端中无法输入的原因是fcitx在启动terminal后定义的，所以修改.xsessionrc文件将
启动terminator放到最后即可。以上配置文件已修改为正确配置。

## Ubantu安装Typora 
之前是使用pandoc将markdown文件转换为epub文件放到kindle中，发现效果不好，后来发现了
donot print插件可以很方便的重组pdf方便不同设备阅读pdf,所以想到可以安装typora先将markdown
转换为pdf, 再进行重组，初步看效果不错。以下将安装过程记录下:
```txt
sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys BA300B7755AFCFAE
sudo add-apt-repository 'deb http://typora.io linux/'
sudo apt install typora
```
注: 使用pandoc将html转换为pdf效果不好，还需要安装一个很大的pdflatex引擎(textlive-full)

## Terminator theme 
在Terminator中安装Dracula主题，将安装步骤记录如下:
```txt
pip install requests
mkdir -p $HOME/.config/terminator/plugins
wget https://git.io/v5Zww -O $HOME"/.config/terminator/plugins/terminator-themes.py"
preference --> plugin --> terminator theme
theme --> dracula --> install
// 如果点击theme无反应，使用sudo apt install python-requests命令
vi ~/.config/terminator/config
replace Dracula with default under profiles setting
```

## Linux处理usb设备 
```txt
sudo fdisk -l  # 查看分区情况，可以看到插入的usb设备，类型一般为dos?也可通过size判断
               # 还可以看见usb的格式类型
sudo mkdir -p /mnt/usb  # 创建挂载点
sudo mount /dev/sdb3 /mnt/usb # 挂载  分区点根据实际情况变化
sudo umount /dev/sdb3     # 卸载
```

## Ubantu 18.04上安装vmware workstation 15.0.3
用虚拟机办公很久了，今天启动时突然又报错`before you can run VMware, some modules must be 
compiled and loaded into the running kernel`, 点击install时是必定失败的，日志报错为
```txt
Failed to build vmmon and Failed to build vmnet.
```
之前报这个错是因为不小心升级了内核版本，后来
自己回退了版本(上文有记录方法)后又可以正常使用了。但今天没有升级内核又报这个错, 上次查问题时
查到vmware需要安装一个补丁，当时试了没用就没管它，今天又搜到该方法的文章，试了成功了!
作者提供了一个脚本，执行后即可正常启动vmware.(拯救了工作机器，Thank God!)
```txt
#!/bin/bash
#This needs to be the actual name of the appropriate branch in mkubecek's GitHub repo for your purposes
VMWARE_VERSION=workstation-15.0.3 
TMP_FOLDER=/tmp/patch-vmware
rm -fdr $TMP_FOLDER
mkdir -p $TMP_FOLDER
cd $TMP_FOLDER
#Use `git branch -a` to find all available branches and find the one that's appropriate for you
git clone https://github.com/mkubecek/vmware-host-modules.git 
cd $TMP_FOLDER/vmware-host-modules
git checkout $VMWARE_VERSION
git fetch
make
sudo make install
sudo rm /usr/lib/vmware/lib/libz.so.1/libz.so.1
sudo ln -s /lib/x86_64-linux-gnu/libz.so.1 /usr/lib/vmware/lib/libz.so.1/libz.so.1
systemctl restart vmware && vmware &
```

下面记录下安装vmware workstation pro 15 过程。
```txt
download install package, e.g., VMware-Workstation-Full-15.0.3-12422535.x86_64.bundle
sudo apt update
sudo apt upgrade
sudo apt install gcc build-essential  # install prerequisites packages
sudo ./VMware-Workstation-Full-15.0.3-12422535.x86_64.bundle

# input product activate code  one of down
UY758-0RXEQ-M81WP-8ZM7Z-Y3HDA
VF750-4MX5Q-488DQ-9WZE9-ZY2D6
UU54R-FVD91-488PP-7NNGC-ZFAX6
YC74H-FGF92-081VZ-R5QNG-P6RY4
YC34H-6WWDK-085MQ-JYPNX-NZRA2
=================
https://www.luochenzhimu.com

sh vmware.sh   # content as above
```
执行脚本中可以看到vmwareworkstation pro 15.0.3版本已经不再更新了，最新版已经到15.1.x了，
15.0.3支持的kernel版本是5.2.(我现在是5.0.0-27-generic)
为了防止激活码过期，还是不要升级了vmwareworkstation了，同时内核版本也可以不升。

## Ubantu 18.04 升级内核版本并开启bbr算法
1. 升级内核
简单的做法是在线升级`sudo do-release-upgrade`(待测试), 还可以自己下载内核deb包手动升级内核.
一般是2个header, 1个image, 用`sudo dpkg -i *.deb`即可(待测试).
2. 开启bbr算法
bbr是google开发的提高网络带宽利用的拥塞控制算法，简单来说就是可以网络加速, 主要是用来提高
上传速度，配置在服务器上时"上传"给客户端即相当于提升了客户端的下载速度，非常适合给自己的
云服务器或VPN服务器安装.Linux 内核4.9版本开始预安装该算法，我刚好5.0.0, 下面就来开启一下。
```txt
开启bbr
$ sudo su
# echo "net.core.default_qdisc=fq" >> /etc/sysctl.conf
# echo "net.ipv4.tcp_congestion_control=bbr" >> /etc/sysctl.conf
// 保存
# sysctl -p
// 查看是否开启
$ sysctl net.ipv4.tcp_available_congestion_control
net.ipv4.tcp_available_congestion_control = bbr cubic reno

$ lsmod | grep bbr
tcp_bbr                20480  0

关闭bbr
$ sed -i '/net\.core\.default_qdisc=fq/d' /etc/sysctl.conf
$ sed -i '/net\.ipv4\.tcp_congestion_control=bbr/d' /etc/sysctl.conf
$ sysctl -p
// 查看是否关闭
$ lsmod | grep bbr
```

## linxu 获取root权限命令
```txt
To get root access, you can use one of a variety of methods:

Run sudo <command> and type in your login password, if prompted, to run only that instance 
of the command as root. Next time you run another or the same command without the sudo 
prefix, you will not have root access.

Run sudo -i. This will give you an interactive root shell. Note that the $ at the end of 
your prompt has changed to a #, indicating that you have root access. But you fall in the 
root home directory (/root/). From here you can run any sequence of commands as root, or 
run the command exit to leave the root shell.

Use the su (substitute user) command to get a root shell. This is effectively the same as 
using sudo -i. Note that when you use this command it will ask for the root password and 
not your login password. These are not the same. You may have to set or change the root 
password by running sudo passwd root first.

Run sudo -s. This gives you root access, but maintains your current SHELL. Shell specific 
settings, including your current directory, are preserved. For instance if you use bash 
(Ubuntu's default shell), aliases (and any other settings from ~/.bashrc) are kept when 
you switch to the root user. To leave the root access, type exit as in the cases above.
```
从以上可以看出，最实用的是`sudo su`,可以保留我的fish shell环境。
开启后提示符会由`$`变为`#`号, 使用完后使用exit退出即可。

## Linux删除旧内核版本
可以删除旧内核节省一点硬盘空间。
```txt
sudo su

dpkg -l | grep linux-image
apt purge linux-image-4.15* -y

// 注意headers 5.0.0.27-generic依赖于5.0.0.27，卸载了5.0.0.27后generic也没有了,
// 还需要apt install 装回来...
dpkg -l | grep linux-headers    
apt purge linux-headers-4.15* -y

dpkg -l | grep linux-modules
apt purge linux-modules-4.15* -y
```

## 实现iphone上写java代码并运行
突然想到如何在手机上运行java代码，上网搜一下，果然有！搜到一个支持jdk7的app可以运行java代码，
不过需要收费，还花18元买了一个Koder，但是点进去运行总报错"are you connected to internet",
看评论知道应该是不能用了，浪费了钱......总结下来，觉得靠谱的方案是:
`在手机上装git客户端，在手机上commit后利用Travis的持续集成功能查看程序运行结果!`, 这应该是
最简便的方案了，但如果有自己的云服务器的话(以后不用蓝灯了要搞一个), 可以在手机上装一个SSH
工具，直接链接到服务器上，这样可支持的功能更多。
实现步骤:
1. 建立github仓库，上传项目
2. Travis关联到github上。
3. 项目中的.travis.yml文件为
```txt
language: java
jdk:
  - openjdk8
cache:
  directories:
    - $HOME/.m2
script: mvn test
```

由于travis是由ruby写的，ruby的依赖是系统范围的，不是针对某个项目的，所以它对于maven项目会
默认执行命令`mvn install -DskipTests=true -Dmaven.javadoc.skip=true -B -V`, install属于
default生命周期中较后面的一个阶段，包括了源码和测试代码的编译。而`-DskipTests=true`不会
执行单元测试，但仍然会编译单元测试生成class文件，`-Dmaven.test.skip=true`即不会编译也不会
执行单元测试。所以Travis已经编译过了新的测试代码，我们不需要clean, 直接执行单元测试即可。

4. 想要看到程序的执行结果时直接在相应的单元测试下打印即可，maven执行单元测试时会打印出来。
5. 手机上使用git app(Working Copy, push需要解锁专业版100元！发现codeHub commit就是push!免费!)
进行推送测试即可。
6. codeHub就是界面没有working copy方便，但是免费!使用open in 存储到文件->Documents, 再
用ivim(:idocuments)打开下载的文件，全选(set clipboard=unnamed有效!)后复制y, 回到codeHub
edit文件粘贴, commit后查看Travis运行日志，到这里就实现了手机写代码并查看运行结果了!
注: ivim单手指长按是隐藏扩展小键盘，双手指长按是隐藏整个键盘，双手指可以上下拖动屏幕。

## 命令行批量命名文件
从InfoQ上下载了一批电子书，打算放到kindle上观看，但是下载文件的文件名都是一长串随机字符，
想要批量进行修改，于是想到使用终端命令一次性搞定(当然不可能逐个mv)！
1. mac上操作
```txt
brew install rename
// 这个版本的rename有-N参数，支持自动递增的文件名 
rename -n -N 01 's/.*.mobi/infoQ-ebook-$N.mobi/' *.mobi
// -n 代表dry-run, 演示重命令效果，并不真正操作
// -N 代表递增参数后面的perl表达式中使用$N来表示递增变量 01是占位符 结果为01, 02, 03...
```
2. ubuntu 18.04上操作

```txt
sudo apt install rename
man rename
// 可以看到这个rename版本不支持-N参数
// 因为后面的表达式是perl表达式，所以想着自定义perl变量来递增，如下
rename -n 'our $d=0;s/.*.md/$d++/e' *.md
// 看到结果为全部命名为0, 原因为变量d每次执行时都被初始化为0,所以没有实现递增，而且后面的
// 替换不能直接写...
// google上搜索到这时可以使用管道一次读取全部文件名，再进行逐一操作，如下
ls -1 -c | xargs rename -n 's/.*.md/our $i; sprintf("%02d.md", $i++)/e'
```

如果不用rename, 还可以这样写

```txt
ls -v | cat -n | while read n f; do mv -n "$f" "$n.md"; done 
```
可以看到这里充分利用了管道的功能，ls列出所有要重命名的文件名，交给cat命令使用-n进行编号，
最后使用mv命令循环重命名。这种方式最为通用，不用额外依赖rename命令。

## linux上的番茄工作法
最近迷上了番茄工作法，发现它对于提高效率，集中注意力办一件事情非常有好处，个人感觉是非常
科学的工作法。它的本质还是一个定时任务，Quara上提供了一个linux上实现的方法，用命令行命令
就能实现，我整理成了脚本，这里记录一下:
```txt
#!/bin/bash

# 25 min = 1500 sec
# 30 min = 1800 sec
sleep 1800 && zenity --info --text '<span foreground="blue" font="32">jobs done!</span>' --no-wrap 2> /dev/null;
sleep 360 && zenity --info --text '<span foreground="blue" font="32">get up!</span>' --no-wrap 2> /dev/null;

#sleep 3 && zenity --info --text '<span foreground="blue" font="32">jobs done!</span>' --no-wrap 2> /dev/null;
#sleep 2 && zenity --info --text '<span foreground="blue" font="32">get up!</span>' --no-wrap 2> /dev/null;
exit 0
```
注: 以上脚本虽然可以满足定时的需要，但是无法暂停(这倒没关系，毕竟这是应当尽量避免的),
其次是无法保存番茄的历史记录，自己写脚本来实现估计可以，但是现在还没什么思路，以后系统
学习了bash shell再看看。Anyway, 网上找到一个google chrome app, 叫"cherry tomato", 界面简洁，
有基本设置和历史记录，用命令`google-chrome --app-id=cghomilbbfdmgfidkdinillpmdpdjgmm`可以
在命令行中启动它，这里是默认已经打开了google浏览器的前提下运行的，不然会报一些错误。

## chrome 使用vimium焦点脱离地址栏
ctrl/command + l focus到地址栏后无法不用鼠标点击网页body脱离焦点(多次tab可以), 网上找到一个
方法可以自定义一个搜索引擎，定义关键字如j, url为javascript:, 这样直接输入j, 再回车即可脱离
焦点从而继续使用vimium快捷键!
注: vimium基本功能外额外键映射。
```txt
map R reload hard   # 清除缓存刷新
map gc closeOtherTabs  # 关闭其他tab页，这是chrome自带的功能，所以vimium作为扩展没有提供
                      # 该功能，这里只是提供了快捷键
unmap <a-p>
map gp togglePinTab  # pin or unpin tab， chrome默认是alt + p，我将它设置为激活pocket扩展，
```

## linux上快速删除文件方法
该方法经测试非常有效，尤其适合删除大文件。
因为rm -rf用于删除大量文件或大文件时速度非常慢，经搜索它是需要逐个遍历每个文件进行删除，
所以很慢，而使用以下命令，直接进行目录替换，没有遍历，所以非常快。
```txt
# 先创建一个空目录
# 注意：最好是用和被清空目录的所有者(用户)去创建这个空目录，使用的命令会将空目录的权限带过去
mkdir /tmp/empty
# 清除目标目录的文件,不要忘记目录后面的`/`
rsync --delete-before -av /tmp/empty/ /xxx/target/
```
--delete-before含义经man命令查看，应该是在进行rsync的增量算法以前执行清空终点目录的意思。

## vmware workstation避开360虚拟机检测
1. 首先安装好vmware tools.
2. 在虚拟机目录中寻找xxx.vmx文件，在最后一行添加
```txt
monitor_control.restrict_backdoor = "true"
```
经测试，成功！

## mac fusion 安装ubuntu 虚拟机整理(总结)
1. 新建虚拟机, 设置参数
2. 安装ubuntu
3. 同步firefox 
4. 改为aliyun源, sudo apt update, sudo apt upgrade
5. 上传coding公钥, 下载config项目
6. 安装vmware-tool, 执行update-vmware-tool脚本
7. sudo apt install vim
8. sudo apt install terminator 
sudo update-alternatives --config x-terminal-emulator
```txt
python --version 2.xxx
sudo apt install python-pip
pip install requests
mkdir -p $HOME/.config/terminator/plugins
   // wget没有vpn连不上, 只能自己从config目录下载相关文件了
wget https://git.io/v5Zww -O $HOME"/.config/terminator/plugins/terminator-themes.py"
preference --> plugin --> terminator theme
theme --> dracula --> install
vi ~/.config/terminator/config
replace Dracula with default under profiles setting
```
在实际执行命令时, 发现要粘贴以上wget命令不用鼠标难以实现复制粘贴功能, vim的可视模式选择
后只有在vim中可以复制粘贴成功, 但无法拷贝内容到终端中执行, 后经过搜索, 这种功能可以用
screen命令或tmux实现, 本质上是将终端变成了"文本", 从而实现了复制粘贴.
注: 发现如果仅仅实现从vim中复制命令到终端执行, 可以很方便的使用fc, fc也是用vim打开, 
所以整个过程都在vim中执行, 这样整个命令执行流为
```txt
可视模式选择文本 -> y复制 -> 退出vim, 或打开一个新的终端 -> 随便输入一个字母, alt + v
打开fc编辑窗口 -> ,v粘贴 -> :x 保存退出 -> enter执行
```
因为alt + v的过程中会使用系统剪贴板进行同步, 所以前面复制不能使用,y, ,y我的配置是
`noremap <Leader>y "+y`, 它只修改了系统剪贴版, 所以会在alt + v的过程中丢失信息.
,v的配置是`noremap <Leader>v "0p`取得就是vim中上一次的复制内容.
实际上y + ,v的组合在我的ideaVim中同样适用(相同的vimrc配置).
注: ,v不好用时还是使用p吧.

9. sudo apt install xmonad xmobar suckless-tools xscreensaver stalonetray feh 
10. fish shell及相关配置
```txt
sudo apt install fish 
chsh -s /usr/local/bin/fish
set fish_greeting
set -U fish_key_bindings fish_vi_key_bindings 
// write this in ~/.config/fish/config.fish
set -gx EDITOR vim
```
11. 复制配置文件`.vimrc .stalonetray .xsessionrc .xmonad/xmonad.hs .xmobarrc 
.bash_aliases .config/fish/functions/* key.sh`
12.  sudo apt install fcitx fcitx-pinyin
配置:
```txt
global config
Trigger input method: Rshift, empty (操作时可以用escape变为empty)
extra key for trigger input method: R_shift
enable hotkey to scroll.... non-check
scroll between input method: ctrl+shift
prev-page: - up
next-page: = down
```
13. 安装vim相关插件, 这一步需要vpn才能较快安装, 修改`/etc/profile.d/wtt_start.sh`文件使用
vpn
注: vim有报错, 后来查看vundle github, 知道使用fish shell时, .vimrc中需要添加:
`set shell=/bin/bash`
14. sudo apt install openjdk-8-jdk, unzip maven.zip


## screen命令实现屏幕拷贝执行命令
感觉screen命令稍微轻量一点.故先使用screen, 毕竟是本地使用, 不涉及远程链接.
因为screen默认引导键是ctrl + a, 它和我的全选快捷键冲突, 所以需要修改,创建~/.screenrc文件,
内容为`escape ^Ss`即改为ctrl + s.
```txt
sudo apt install screen
screen -S 0    // 新建名称为0的session
screen -XS [sessionName] quit  // 删除某个session
screen -r 0   // 重新链接到session 0, reattach
// 窗口windows内操作
ctrl + s, d   // detach current session
ctrl + s, c   // create new window
ctrl + s, [   // 进入复制模式
space开始选择, space结束选择
ctrl + s, ctrl + s 
             // 切换到前一个window, 2个窗口的情况下可来回切换,这里可按住ctrl键不放
             // 实际上由于我将space修饰为ctrl, 所以按住space键也可以
ctrl + s, ]  // 粘贴刚才复制的内容
ctrl + s, "  // 列出窗口列表
ctrl + s, k  // 杀死当前窗口
```
screen创建的session默认是打开bash, 从这一点看, 它应该是写死的使用bash shell, 没有查看
当前用户设置的默认shell(我的是fish), 所以可以通过以下命令设置别名:
```txt
alias ss 'screen -S $argv[1] bash -c "fish"'
```
总结: 通过使用screen, 我们就可以从vim文本中复制命令到另一个窗口中直接执行了.
命令执行流为
```txt
c-s, [     // enter copy mode
space -> space  // can use h, l, f, t and others to move cursor
c-s, c-s   // enter next window
c-s, ]     // paste the command to execute
```

## install v2ray
最近蓝灯连不上了, 刚好女朋友公司给了一个v2rayN的客户端, 研究了下, 发现确实可以用, 主要是
可以蹭他们的服务器...下面记录下安装步骤
1. 检查时间, v2ray要求客户端和服务端必须同步时间, 误差在90秒内. 所以客户端最好检查是否
设置了自动同步时间.
2. v2ray服务端和客户端是一体的, 区别仅在于配置文件config.json, json文件是系统平台通用的,
所以windows, mac, linux客户端完全可以使用同一个配置文件.
3. wget https://install.direct/go.sh(原本担心会需要翻墙才能顺利下载, 好在没有这问题)
4. sudo bash go.sh, 该命令执行后会打印出服务器port和id, 但对于客户端没啥用.
5. sudo systemctl start v2ray, 启动v2ray服务.
```txt
sudo systemctl restart v2ray   // 修改配置文件后需要重启服务生效
sudo systemctl enable v2ray    // 脚本里应该执行了这个, 默认开机启动
sudo systemctl disable v2ray   // 取消开机启动
sudo systemctl stop v2ray     // 停止v2ray服务
```
配置文件在/etc/v2ray/config.json中, 修改后重启v2ray服务, 浏览器本身再设置以下代理, 
我配置文件中是socks协议, 浏览器也只能写socks协议, 否则通过命令
`sudo journalctl -b -u v2ray`可以看到报错: `unknown socks version: 67`.
注: 用美区appleId在apple store上找了一个支持vmess协议的app: 91vpn, 配置好后可以查看到
配置的config.json文件, 成功在ios上实现了翻墙!
注: firefox浏览器在设置中即可开启代理, chrome需要通过命令行参数指定代理服务器, 登上账号
后可以使用扩展插件switchyOmega执行代理.
```txt
google-chrome --proxy-server=socks5://127.0.0.1:1080
```

注: 如果需要用到多实例多开, 可以使用以下命令, 主要是`man google-chrome`的用法:
```txt
google-chrome --proxy-server=socks5://127.0.0.1:1080 
  --user-data-dir=/home/tao/Documents/share/note/chrome1/
```

## filco键盘蓝牙配对
以前脑子发热买了个filco, 主要是蓝牙功能很不错, 但设置有点麻烦, 以下是网上的资料记录下:
```txt
首先，切换设备的快捷键，同时按下 ctrl+alt+fn，然后松开，再立刻按 1~4，代表了当前在用指定
数字的蓝牙通道连接设备。
其次，键盘背面的复位按键，是清除当前蓝牙通道连接的设备，让当前通道进入配对状态。
而不是把所有四个通道都清除（因为这个误解，我困惑了很久）
第三，在切换到通道后，如果蓝灯慢速闪烁 10 秒，说明原来的通道已经占用。蓝灯快闪 60 秒，
说明正在等待配对。

接下来的连接过程就比较简单了。
1、切换到指定通道。如果是蓝灯慢闪，就按一下键盘背后的复位键
2、确保键盘出于配对状态，再在电脑或者手机上进行连接 /配对， 这个过程就和其他蓝牙键盘没有
区别了
3、配对成功后的检查。试一下本通道可以正常操作，再切换到其他通道，确认其他通道依然正常，
和新增配对设备之前没有变化。
```

## mac switch between applications
最近一直都使用linux(主要是ubuntu), mac作为一个宿主机，在上面也是用虚拟机，但在里面使用
windows的时候也想要用命令行或vim等工具，但在里面再去装cmder又感觉是多此一举，所以可以
在mac的终端vim中编写，但应用打开较多时，使用command tab就比较麻烦，网上查找了下mac上
application switcher原生支持的快捷键，使用起来对于基本操作需求还是很方便的---除了
在switcher中查找的功能, 这个感觉还是要下载一个第三方工具.
```txt
command + tab   按住command打开switcher，按tab切换到下一个应用
command + shift + tab / command + `   switcher中切换到上一个应用，其中command + ` 单独按  
               是在同应用中切换不同窗口，如浏览器等，非常好用
command + q    在switcher中关闭switcher中选中的图标应用
command + m    minify the selected application
commmand + 1  在switcher中显示该应用所有的窗口，包括上面最小化的窗口
```
以上快捷键虽然好用，但真正好用的还是专门的第三方app: Context,
1. ctrl + space  弹出switcher窗口，并可以搜索，command + j/k 可以上下切换
2. 设置中可以对最小化和被隐藏的窗口设置是否显示和列表位置

windows中类似的工具推荐switcheroo, 它有同样的搜索列表页面，可以搜索当前打开的应用，
将弹出的快捷键由alt +space(和spot light冲突)改为alt + s，使用默认的alt + tab，
释放alt键时即切换(同原生功能一样)，因为listary默认也是alt + s,可以双击ctrl键弹出listary。

总结:
1. ctrl + space切换输入法快捷键保持不变，这点可以修改但会引起很多问题。
2. mac中command + tab键弹出列表页面，单独按command + space可以搜索switcher，spotlight仍然
是alt + space.
3. windows中alt + tab键弹出列表页面，单独按alt + s可以搜索，双击ctrl可以弹出listary,当 
windows系统不在虚拟机中时, 因为原生按键是alt + tab, 所以可以使用alt + space(switchroo), 
alt + s(listary), 不使用win键。
注: 
contexts在搜索列表页面中可以使用command + q退出相应的程序，方便快捷。
搜索列表中后面有相应的标签，搜索里面可以输入相应的英文，加快过滤结果。
再注: 通过以上快捷键的配置，mac里面还是以command键主导，command +space, tab操作，alt+space
spotlight, windows里面以alt键主导，alt + space, tab操作，alt +s listary.

## zathura invert colors
linux zathura is a wonderful pdf reader, its invert color default shortcut key is
```txt
ctrl + r
```

## sticky keys for capital letter
There has been a long time since last editing my blogs, actually I am focusing on
my touch typing recently, earlier days I switch to workman layout and using it
in work, but when using it for coding, I found it not too different with qwerty
layout, the ; , - = all on the rightest side and make my right pinky finger pain!
All these years I look at the keyboard and type these special characters!!!
I need to reduce the workload of my right pinky finger! So I find the 
dvorak programmer(dvp)! pure dvorak is not good as workman for me as i key is not
good in dvorak, but dvp is awesome for its ; , ' symbols! 

So I change the layout variant to dvp in X11, and find a ahk script for dvp in
windows(lucky!), and keep practicing ... and find capital case letter typing is
quite slow! Then I google it and find Sticky key for this usage!

simply put it, sticky key make typing capitale letters no need to keep pressing 
shift key all the time, we just need to press it once and release it, then the
next letter auto capitalised and become lowercase again afterwards!

this way is quite straightforward and fast. No need to keep pressing and all 
upper and lower case letters are hit with one hitting.

X11:
vim ~/.xkb/symbols/evdoublebind
add
```txt
   replace key <LFSH> { [ ISO_Level2_Latch ] };
   replace key <RTSH> { [ ISO_Level2_Latch ] };
```
vim /usr/share/X11/xkb/compat/basic
add
```txt
   interpret ISO_Level2_Latch+AnyOf(all) {
       useModMapMods=level1;
       action= LatchMods(modifiers=Shift,clearLocks,latchToLock);
   };
   interpret ISO_Level2_Latch+AnyOfOrNone(all) {
       action= LatchMods(modifiers=Shift,clearLocks,latchToLock);
   };
```
after testing, single hit shift make next character upper case or the upper 
character of key such as number row keys, and double hitting shift lock shift 
function and hit any shift once again cancel it.

ps: using the shift lock function make inputing many numbers sequentially quite
conveniently! Best for 86 keys layout keyboard without numberPad.

windows system:
start menu -> control panel -> little icon -> easy to use computer
enable sticky keys, default hitting 5 times shift keys enable it,
remember disable closing shift keys when pressing double shift together.

PS: sticky key essentially are "extending" the instant hitting of modifier keys, 
so it conflicts with double-role keys. In X11, space is ctrl(stable) and only make 
shift as sticky to type capitalized letter is quite OK, and bigCtrl in windows system
is unstable and system own sticky key is global-not just shift keys, so the bigCtrl 
can not be used in reality. So we can just make capslock as ctrl, hope ahk is stable 
for doing this.  (to be tested)

## dvp layout practical solution
```txt
windows without vmware:
  
  1. install dvp layout
  2. switch u and i using keytweak
  3. change system regedit for chinese input with dvp layout
     2020-11-20 20:09:56 added: 
        HKEY_LOCAL_MACHINE/SYSTEM?CurrentControlSet/Control/Keyboard Layouts/00000804
          layout file from KBDUS.DLL to kbddvp.dll
  4. enable sticky key function

linux X11:
  1. using workman script to change layout to dvp.
  2. edit x11 symbols us dvorak switch u and i.
  3. using evdoublebind to get bigCtrl->space-ctrl
  4. edit .xkb/symbols/evdoublebind to make only shift sticky, also 
     need to edit compact/basic (check x11 wiki)
  5. fcitx-configtool change chinese input layout
  
  ps: as we have bigCtrl here, no need to make ctrl sticky again!
```

## windows bash copy and paste
new company use windows server 2012 as web server, so the basic deployment is copy and 
paste files, such as tomcat war files and node dist files, and I need to back up the old
files each time for safety, so we need to make it automatic. And we use bat file and 
xcopy command.

```txto off
for /F "usebackq tokens=1,2 delims==" %%i in (`wmic os get LocalDateTime /VALUE 2^>NUL`) do if '.%%i.'=='.LocalDateTime.' set ldt=%%j
set yyyy=%ldt:~0,4%
set mm=%ldt:~4,2%
set dd=%ldt:~6,2%
start cmd /k "xcopy H:\wtt\t1\* H:\wtt\%mm%-%dd%-%yyyy% /e /s /y /i"
quit
```
/e: Copies all subdirectories, even if they are empty. 
/s: Copies directories and subdirectories, unless they are empty. 
If you omit /s, xcopy works within a single directory.
/y: Suppresses prompting to confirm that you want to overwrite an existing destination file.
/i: If Source is a directory or contains wildcards and Destination does not exist, xcopy assumes Destination specifies a directory name and creates a new directory. Then, xcopy copies all specified files into the new directory. By default, xcopy prompts you to specify whether Destination is a file or a directory.

delete a directory contents and all of its sub directories:
```txt
RD /S /Q "H:\wtt\11-23-2020"
```
/S      Removes all directories and files in the specified directory
        in addition to the directory itself.  Used to remove a directory
        tree.

/Q      Quiet mode, do not ask if ok to remove a directory tree with /S

this command will delete the directory itself, sometimes we want to keep the directory,
so we can use command such as "MD H:\wtt\11-23-2020" to recreate it.

## excel复制内容到文本自动有双引号
as the title says, the resolution is add one new column, use formula: =clean(D2), the D2
is the original column, in this way, the content will remove double quotation marks, 
and the original alt + enter carriages will also be removed, too.
PS: it is useful for one-line-string field for table insertion script.

<hr />
<img src="http://wutaotaospace.oss-cn-beijing.aliyuncs.com/image/201901311.jpg" class="full-image" />

