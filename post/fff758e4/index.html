<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




  
  
    
      
    
    
      
    
  <script src="//cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"></script>
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/blue/pace-theme-minimal.min.css">







  <meta name="google-site-verification" content="GNI8KNzHxdOObg1xzQwHXPStlrnPJHC4Cw1iZMCCe9U">














  
  
  
  

  

  

  

  

  

  






  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css">

<link rel="stylesheet" href="/css/main.css?v=7.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.0.0',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},
    fancybox: false,
    fastclick: false,
    lazyload: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: 'LEJ8JV9ZSY',
      apiKey: '9572d9f139c3c642cdbaaa2caf3123c9',
      indexName: 'searchIndex',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="note of how to program">
<meta name="keywords" content="Method,Racket,Lisp">
<meta property="og:type" content="article">
<meta property="og:title" content="HowToProgramNote">
<meta property="og:url" content="http://www.taoblog.cn/post/fff758e4/index.html">
<meta property="og:site_name" content="TaoBlog">
<meta property="og:description" content="note of how to program">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==">
<meta property="og:updated_time" content="2020-01-01T11:29:23.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="HowToProgramNote">
<meta name="twitter:description" content="note of how to program">
<meta name="twitter:image" content="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==">



  <link rel="alternate" href="/atom.xml" title="TaoBlog" type="application/atom+xml">




  <link rel="canonical" href="http://www.taoblog.cn/post/fff758e4/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>HowToProgramNote | TaoBlog</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">TaoBlog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">Sharing makes us better</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签<span class="badge">50</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类<span class="badge">17</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档<span class="badge">23</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-message">

    
    
    
      
    

    
      
    

    <a href="/message/" rel="section"><i class="menu-item-icon fa fa-fw fa-comment"></i> <br>留言板</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.taoblog.cn/post/fff758e4/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="吴涛涛">
      <meta itemprop="description" content="wutaotao personal blog">
      <meta itemprop="image" content="http://wutaotaospace.oss-cn-beijing.aliyuncs.com/image/maya.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TaoBlog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">HowToProgramNote

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-10-13 22:14:01 22:14:01" itemprop="dateCreated datePublished" datetime="2019-10-13T22:14:01+08:00">2019-10-13 22:14:01</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-01-01 19:29:23 19:29:23" itemprop="dateModified" datetime="2020-01-01T19:29:23+08:00">2020-01-01 19:29:23</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Method/" itemprop="url" rel="index"><span itemprop="name">Method</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/post/fff758e4/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/post/fff758e4/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
            <span id="/post/fff758e4/" class="leancloud_visitors" data-flag-title="HowToProgramNote">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">20k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">18 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>note of how to program<br><a id="more"></a></p>
<h2 id="程序设计步骤"><a href="#程序设计步骤" class="headerlink" title="程序设计步骤"></a>程序设计步骤</h2><h3 id="设计方法步骤"><a href="#设计方法步骤" class="headerlink" title="设计方法步骤"></a>设计方法步骤</h3><ol>
<li><p>data represents information. 数据代表了什么现实世界的信息<br>这一步实际是程序的数据结构设计，或是表设计的步骤。</p>
</li>
<li><p>a signature, a purpose statement, test cases, a function header</p>
<p>数据结构设计好后开始编写方法模板</p>
<p>注释signature: 方法签名，输入到输出 如; number -&gt; string<br>注释purpose:  方法的目的。 如 ; move x pixels down from the center of scene y<br>test  测试案例， 使用前面给出的例子测试<br>header:  方法模板，输出最简单的形式。 如 (define (change num) “string”)</p>
</li>
<li><p>code  实现方法， 按照给定的输入参数实现方法目的(purpose)。</p>
</li>
<li>run</li>
</ol>
<h3 id="设计世界程序步骤"><a href="#设计世界程序步骤" class="headerlink" title="设计世界程序步骤"></a>设计世界程序步骤</h3><ol>
<li><p>确定世界中不随时间变化的性质作为常量。一种是对象的物理性质常量，另一种是对象的图片常量.<br>后者通常使用前者进行复合计算得到。这些图片常量组合起来即可得到世界的某个完整状态。</p>
<p>常量的表达式可以在交互区测试得到。<br>同状态的最小集类似，在编写常量实现时应尽可能减小变量个数，这称为”单点控制”(single control)</p>
</li>
<li><p>确定世界中随时间变化的性质，将它们集合起来用一个数据对象来表示，它应该是能确定整个世界<br>图像的最小集。这个最小集就是该世界的状态。<br>应给出注释说明如何将现实世界的信息表示成该状态对象，同时将该状态对象解释成现实世界的信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">; A WorldState is a Number  (info -&gt; state)</span><br><span class="line">; the number is the time passed from the start to current time (state -&gt; info)</span><br></pre></td></tr></table></figure>
<p>注: 有时最小集有多个，任意选择一个作为状态对象即可。</p>
</li>
<li><p>确定好状态对象后，编写多个方法以完成一个bigbang表达式。如渲染方法(render)将状态显示为<br>一个图像，哪些事件处理对象影响了状态对象的哪些属性，如时间，键盘，鼠标事件等，最后根据<br>需求，确定当状态对象满足了哪些条件时需要停止程序，即end?方法。<br>将每个需要编写的方法放在wish list中，方法为模板方法，提供简单实现，符合方法签名即可。如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">; worldstate -&gt; image</span><br><span class="line">; place image of car x pixels from the left of margin of the background image</span><br><span class="line">(define (render x) (place-image CAR X Y BG))</span><br><span class="line"></span><br><span class="line">; worldstate -&gt; worldstate</span><br><span class="line">; add 3 to x to move the car right</span><br><span class="line">(define (tock x) (+ x 3))</span><br><span class="line"></span><br><span class="line">; worldstate -&gt; boolean</span><br><span class="line">; when to stop, 注意这里不能只用=号，toc + 3可能取不到该值，</span><br><span class="line">; 跳过后继续运行，end?一直为#f</span><br><span class="line">(define (end? ws) (&gt;= ws 100))</span><br></pre></td></tr></table></figure>
</li>
<li><p>write a main function. 它不需要设计和测试，作为就是方便在交互区启动世界项目。需要考虑的<br>仅为它的方法参数。如初始状态等。代码为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">; worldstate -&gt; worldstate   (big-bang方法返回值也为状态)</span><br><span class="line">; launch program from some initial state</span><br><span class="line">(define (main ws) (big-bang ws [on-tick tock] [to-draw render]))</span><br></pre></td></tr></table></figure>
<p>on-tick默认计数频率为1/28, 即1秒28次tick.<br>mouse-event:  button-down, button-up, drag, move, enter, leave</p>
<p>下面为我的exercise 47的习题答案，主要是<br>place-image的用法花了较多时间，搞清楚图片的定位(anchor)和偏移距离的计算起始点。<br>代码如下, language: BSL, beginning student language</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">;; using up and down to charge battery</span><br><span class="line"></span><br><span class="line">(require 2htdp/image)</span><br><span class="line">(require 2htdp/universe)</span><br><span class="line"></span><br><span class="line">; constants</span><br><span class="line">(define BGW 100)</span><br><span class="line">(define BGH 200)</span><br><span class="line">(define MS 5)</span><br><span class="line">(define RW (- BGW (* 2 MS)))</span><br><span class="line">(define RH (- BGH  MS))</span><br><span class="line">; number -&gt; number</span><br><span class="line">; the height of red bar, hap is happiness, 0 to 100</span><br><span class="line">(define (RHF hap) (* RH hap 0.01))</span><br><span class="line">(define BG (rectangle BGW BGH &quot;solid&quot; &quot;black&quot;))</span><br><span class="line"></span><br><span class="line">; world state is a number [0,100]</span><br><span class="line">; number is height of red bar&apos;s height ratio to RH</span><br><span class="line"></span><br><span class="line">; ws -&gt; image</span><br><span class="line">; place-image would crop image to meet the need, place-image/align&apos;s function</span><br><span class="line">; is to anchor the image, here it stick the red bar at the x&apos;s center and y&apos;s bottom</span><br><span class="line">; x is distance from middle to the left, y is distance from the top to the bottom </span><br><span class="line">; so the distance is always counted from left and top</span><br><span class="line">(define (render ws)(place-image/align (rectangle RW (RHF ws) &quot;solid&quot; &quot;red&quot;)</span><br><span class="line">             (+ MS (* 0.5 RW)) RH &quot;center&quot; &quot;bottom&quot; BG)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">; ws-&gt;ws</span><br><span class="line">; each tick ws decrease by 0.5</span><br><span class="line">(define (tock ws) (- ws 0.5))</span><br><span class="line"></span><br><span class="line">; number,number -&gt; number</span><br><span class="line">; over 100 set to 100, or set to num * fac</span><br><span class="line">(define (feed num fac) (if (&gt;= (* num fac) 100) 100 (* num fac)))      </span><br><span class="line"></span><br><span class="line">; ws-&gt;ws</span><br><span class="line">; key event handler, down arrow key increase ws by 1/5, up arrow key increase ws by 1/3 </span><br><span class="line">; maximum can not be bigger than 100</span><br><span class="line">(define (kh ws key) </span><br><span class="line">  (cond </span><br><span class="line">    [(string=? key &quot;down&quot;) (feed ws 6/5)]</span><br><span class="line">    [(string=? key &quot;up&quot;)  (feed ws 4/3)]</span><br><span class="line">    [else ws]</span><br><span class="line">    ))</span><br><span class="line">(check-expect (kh 30 &quot;down&quot;) 36)</span><br><span class="line">(check-expect (kh 30 &quot;up&quot;) 40)</span><br><span class="line">(check-expect (kh 30 &quot;left&quot;) 30)</span><br><span class="line"></span><br><span class="line">; ws-&gt;ws</span><br><span class="line">; stop when ws = 0, because of multiplying, it can never equal to 0</span><br><span class="line">(define (end? ws) (&lt;= ws 0) )</span><br><span class="line">; ws -&gt; image</span><br><span class="line">; last image when world ended </span><br><span class="line">(define (last-pic ws) (text &quot;your\nbattery\nis\nout!&quot; 30 &quot;red&quot;))</span><br><span class="line"></span><br><span class="line">; main</span><br><span class="line">(define (main ws) </span><br><span class="line">  (big-bang ws </span><br><span class="line">    [to-draw render]</span><br><span class="line">    [on-tick tock]</span><br><span class="line">    [on-key kh]</span><br><span class="line">    [stop-when end? last-pic]))</span><br><span class="line"></span><br><span class="line">(main 100)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="枚举，区间和泛化"><a href="#枚举，区间和泛化" class="headerlink" title="枚举，区间和泛化"></a>枚举，区间和泛化</h3><p>除了用基本数据类型，如string, number, image, boolean作为状态对象，我们还可以使用枚举，<br>区间和条目作为数据类型，它们使用cond表达式在基本类型的基础上进行处理，按照各自概念进行定义。<br>如枚举使用=, string=?, false?(没有true?的定义)等判断每一个条件，区间使用&gt;, &lt;判断每一个条件。<br>泛化适用于不同判断条件类型的cond表达式，如NorF即为元素类型在num和#f中进行判断。</p>
<p>注: cond表达式可以嵌套在其他方法中，使用时应包含最小变量集合表达式。<br>新的数据类型为更复杂的控制提供了可能，下面是我写的用空格键触发火箭升空的小动画(在查看<br>教程代码之前)。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">;; using space key to launch ufo, with counting down feature</span><br><span class="line"></span><br><span class="line">(require 2htdp/image)</span><br><span class="line">(require 2htdp/batch-io)</span><br><span class="line">(require 2htdp/universe)</span><br><span class="line"></span><br><span class="line">; constants</span><br><span class="line">(define BGW 400)</span><br><span class="line">(define BGH 600)</span><br><span class="line">(define BG (empty-scene BGW BGH))</span><br><span class="line">(define UFO (overlay/align &quot;middle&quot; &quot;bottom&quot; </span><br><span class="line">                           (ellipse 40 10 &quot;solid&quot; &quot;blue&quot;)</span><br><span class="line">                           (circle 10 &quot;solid&quot; &quot;red&quot;)))</span><br><span class="line">(define V 4)</span><br><span class="line">; 6 seconds</span><br><span class="line">(define C -3)</span><br><span class="line">(define CN (* C 28))</span><br><span class="line">;(place-image/align UFO (/ BGW 2) BGH &quot;middle&quot; &quot;bottom&quot; BG)</span><br><span class="line"></span><br><span class="line">; world state is LR(itemization)</span><br><span class="line">; LR is &quot;starting&quot; or the pixels to the bottom(it is getting bigger as ticks go)</span><br><span class="line">; or -N is countDown</span><br><span class="line"></span><br><span class="line">; ws -&gt; image</span><br><span class="line">(define (place ws) (place-image/align UFO (/ BGW 2) ws &quot;middle&quot; &quot;bottom&quot; BG))</span><br><span class="line"></span><br><span class="line">; ws -&gt; ws</span><br><span class="line">; render ws to image</span><br><span class="line">(define (render ws) </span><br><span class="line">  (cond</span><br><span class="line">    [(string? ws) (place BGH)]</span><br><span class="line">    [(&gt; ws 0) (place (- BGH ws))]</span><br><span class="line">    [else (place-image </span><br><span class="line">            (text (number-&gt;string ws)</span><br><span class="line">                  20 &quot;red&quot;) 100 100 (place BGH))]</span><br><span class="line">    )</span><br><span class="line">)</span><br><span class="line">(check-expect (render &quot;s&quot;) (place-image/align UFO (/ BGW 2) BGH  &quot;middle&quot; &quot;bottom&quot; BG))</span><br><span class="line">(check-expect (render 30) (place-image/align UFO (/ BGW 2) (- BGH 30) &quot;middle&quot; &quot;bottom&quot; BG))</span><br><span class="line">(check-expect (render CN) (place-image (text  (number-&gt;string CN) 20 &quot;red&quot;) 100 100 (place BG)))</span><br><span class="line"></span><br><span class="line">; ws -&gt; ws</span><br><span class="line">; tick handler &quot;stop&quot; is static, number means ufo is getting up</span><br><span class="line">(define (tock ws) </span><br><span class="line">          (cond </span><br><span class="line">           [(string? ws) ws] </span><br><span class="line">           [(&lt;= ws 0) (+ ws 1)]</span><br><span class="line">           [else (+ ws V)] </span><br><span class="line">          )</span><br><span class="line">)</span><br><span class="line">(check-expect (tock &quot;s&quot;) &quot;s&quot;)</span><br><span class="line">(check-expect (tock CN) (+ CN 1))</span><br><span class="line">(check-expect (tock 10) (+ 10 V))</span><br><span class="line"></span><br><span class="line">; ws-&gt;ws</span><br><span class="line">; only when ufo is not launching, press space key will launch ufo</span><br><span class="line">(define (kh ws key) </span><br><span class="line">  (if (and (string=? key &quot; &quot;) (string? ws)) CN ws))</span><br><span class="line"></span><br><span class="line">(check-expect (kh &quot;s&quot; &quot; &quot;) CN)</span><br><span class="line">(check-expect (kh &quot;s&quot; &quot;r&quot;) &quot;s&quot;)</span><br><span class="line">(check-expect (kh 1 &quot;r&quot;) 1)</span><br><span class="line">(check-expect (kh 6 &quot; &quot;) 6)</span><br><span class="line"></span><br><span class="line">; ws-&gt;boolean</span><br><span class="line">; when getting to the top, world ends</span><br><span class="line">; because of cond mechanism, it must judge string first, than it can use &lt;= 0 operation</span><br><span class="line">(define (end? ws) </span><br><span class="line">          (cond </span><br><span class="line">           [(string? ws) #f] </span><br><span class="line">           [(&gt;= ws BGH) #t] </span><br><span class="line">           [else #f] </span><br><span class="line">          ))</span><br><span class="line">(check-expect (end? &quot;s&quot;) #f)</span><br><span class="line">(check-expect (end? -6) #f)</span><br><span class="line">(check-expect (end? 23) #f)</span><br><span class="line">(check-expect (end? (+ 1 BGH)) #t)</span><br><span class="line"></span><br><span class="line">; ws-&gt;image</span><br><span class="line">(define (last ws) (text &quot;UFO\nfly\naway!&quot; 20 &quot;red&quot;))</span><br><span class="line"></span><br><span class="line">; ws -&gt; ws </span><br><span class="line">; if main function here has no parameter, it is just a constant, using (define main ...),</span><br><span class="line">; drrackt will evaluate it and execute big-bang,</span><br><span class="line">; using (main ws) will make it a function and do not execute big-bang</span><br><span class="line">(define (main ws)</span><br><span class="line">  (big-bang &quot;starting&quot;</span><br><span class="line">    [on-tick tock]</span><br><span class="line">    [to-draw render]</span><br><span class="line">    [stop-when end? last]</span><br><span class="line">    [on-key kh]</span><br><span class="line">    ))</span><br><span class="line"></span><br><span class="line">(main &quot;go&quot;)</span><br></pre></td></tr></table></figure></p>
<p>通过阅读后面教程的实现，发现了自己编程的一些问题:</p>
<ol>
<li><p>state状态对象是变量性质的最小集，它集成了按空格键，倒计时，升空这3种状态，<br>即需要在设计时就将变量通过泛化(itemization)的形式纳入到world state中来。这一点在实现倒计时<br>功能时没有考虑到，所以刚开始实现较困难。</p>
</li>
<li><p>实现方法时应根据不同的条件先写单元测试(check-expect)(在交互区测试语句),<br>再根据不同条件编写cond表达式，最后组合成方法的实现，这种方式最稳妥，其实也是最快的。</p>
</li>
<li><p>区间的边界情况我的程序中没有加以判断，如倒计时为-1时需要将ws变为height.但由于我考虑的是<br>ws从负数一直递增到BGH,中间没有转折。从下面书中的示例可以看出先递增后递减也是可以实现的<br>(end? 方法加以判断即可，本质还是因为ws的区间范围是明确划分的，所以先递增后递减也行)。<br>但书中也提出，使用负数作为倒计时的设计是比较脆弱的。如我将ufo的速度YDELTA调整为40，程序<br>结束后提示show中的cond表达式全部为false, 即升空后ws以YDELTA速度递减，到顶后变为负数<br>(小于-3)，调整V大小ws甚至可能落入-3至0的区间内，从而导致bug。所以这里使用负数表示倒计时<br>是不合适的。</p>
</li>
</ol>
<p>下面为书中程序代码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">;; using space key to launch ufo, with counting down feature</span><br><span class="line"></span><br><span class="line">(require 2htdp/image)</span><br><span class="line">(require 2htdp/universe)</span><br><span class="line">(require 2htdp/batch-io)</span><br><span class="line"></span><br><span class="line">(define HEIGHT 300) ; distances in pixels </span><br><span class="line">(define WIDTH  100)</span><br><span class="line">(define YDELTA 40)</span><br><span class="line"> </span><br><span class="line">(define BACKG  (empty-scene WIDTH HEIGHT))</span><br><span class="line">(define ROCKET (rectangle 5 30 &quot;solid&quot; &quot;red&quot;))</span><br><span class="line"> </span><br><span class="line">(define CENTER (/ (image-height ROCKET) 2))</span><br><span class="line"></span><br><span class="line">; An LRCD (for launching rocket countdown) is one of:</span><br><span class="line">; – &quot;resting&quot;</span><br><span class="line">; – a Number between -3 and -1</span><br><span class="line">; – a NonnegativeNumber </span><br><span class="line">; interpretation a grounded rocket, in countdown mode,</span><br><span class="line">; a number denotes the number of pixels between the</span><br><span class="line">; top of the canvas and the rocket (its height)</span><br><span class="line"></span><br><span class="line">(check-expect</span><br><span class="line"> (show HEIGHT)</span><br><span class="line"> (place-image ROCKET 10 (- HEIGHT CENTER) BACKG))</span><br><span class="line"> </span><br><span class="line">(check-expect</span><br><span class="line"> (show 53)</span><br><span class="line"> (place-image ROCKET 10 (- 53 CENTER) BACKG))</span><br><span class="line"></span><br><span class="line">(define (place x)(place-image ROCKET 10 (- x CENTER) BACKG))</span><br><span class="line"></span><br><span class="line">(define (show x)</span><br><span class="line">  (cond</span><br><span class="line">    [(string? x) (place HEIGHT)]</span><br><span class="line">    [(&lt;= -3 x -1)</span><br><span class="line">     (place-image (text (number-&gt;string x) 20 &quot;red&quot;) 10 (* 3/4 WIDTH) (place HEIGHT))]</span><br><span class="line">    [(&gt;= x 0) (place x)]))</span><br><span class="line"></span><br><span class="line">(check-expect (launch &quot;resting&quot; &quot; &quot;) -3)</span><br><span class="line">(check-expect (launch &quot;resting&quot; &quot;a&quot;) &quot;resting&quot;)</span><br><span class="line">(check-expect (launch -3 &quot; &quot;) -3)</span><br><span class="line">(check-expect (launch -1 &quot; &quot;) -1)</span><br><span class="line">(check-expect (launch 33 &quot; &quot;) 33)</span><br><span class="line">(check-expect (launch 33 &quot;a&quot;) 33)</span><br><span class="line"></span><br><span class="line">(define (launch x ke)</span><br><span class="line">  (cond</span><br><span class="line">    [(string? x) (if (string=? &quot; &quot; ke) -3 x)]</span><br><span class="line">    [(&lt;= -3 x -1) x]</span><br><span class="line">    [(&gt;= x 0) x]))</span><br><span class="line"></span><br><span class="line">; LRCD -&gt; LRCD</span><br><span class="line">(define (main1 s)</span><br><span class="line">  (big-bang s</span><br><span class="line">    [to-draw show]</span><br><span class="line">    [on-key launch]))</span><br><span class="line"></span><br><span class="line">; LRCD -&gt; LRCD</span><br><span class="line">; raises the rocket by YDELTA if it is moving already </span><br><span class="line"> </span><br><span class="line">(check-expect (fly &quot;resting&quot;) &quot;resting&quot;)</span><br><span class="line">(check-expect (fly -3) -2)</span><br><span class="line">(check-expect (fly -2) -1)</span><br><span class="line">(check-expect (fly -1) HEIGHT)</span><br><span class="line">(check-expect (fly 10) (- 10 YDELTA))</span><br><span class="line">(check-expect (fly 22) (- 22 YDELTA))</span><br><span class="line"> </span><br><span class="line">(define (fly x)</span><br><span class="line">  (cond</span><br><span class="line">    [(string? x) x]</span><br><span class="line">    [(&lt;= -3 x -1) (if (= x -1) HEIGHT (+ x 1))]</span><br><span class="line">    [(&gt;= x 0) (- x YDELTA)]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">; ws-&gt;image</span><br><span class="line">(define (end? ws) (cond </span><br><span class="line">                    [(string? ws) #f]</span><br><span class="line">                    [(&lt;= 0 ws CENTER) #t]</span><br><span class="line">                    [else false]))</span><br><span class="line"></span><br><span class="line">; LRCD -&gt; LRCD</span><br><span class="line">(define (main2 s)</span><br><span class="line">  (big-bang s</span><br><span class="line">    [to-draw show]</span><br><span class="line">    [on-key launch]</span><br><span class="line">    [on-tick fly 1]</span><br><span class="line">    [stop-when end?]</span><br><span class="line">    ))</span><br><span class="line">(main2 &quot;test&quot;)</span><br></pre></td></tr></table></figure></p>
<h3 id="finite-states-worlds"><a href="#finite-states-worlds" class="headerlink" title="finite states worlds"></a>finite states worlds</h3><p>有穷状态图中状态可以使用符号常量来表示，如红绿灯中的红灯可以使用(define RED 0)或<br>(define RED “red”)来定义，因为Racket是动态语言，(eq? 0 0)和(eq? “s” “s”)同时为#t，<br>甚至(eq? “s” 0)也能正常运行，不报错，值为false. (其他比较方法还有eqv? equal?), 所以它为状态实际数据类型的变化提供了支持，这就是动态类型的好处。</p>
<h3 id="adding-structure"><a href="#adding-structure" class="headerlink" title="adding structure"></a>adding structure</h3><p>前面的火箭倒计时程序中，状态虽然使用不同类型的数据(“stop”字符串和代表高度的数字)来表示<br>火箭不同的状态，但整个程序中变量只有一个(“stop”时火箭是静止的，升空后变化的是高度)，如果<br>程序中有2个或2个以上的性质同时发生变化怎么办? 如支持往返飞行火箭的高度和方向。<br>这就是类似面向对象中对象的概念, structure.</p>
<p>(define-struct person [name age])类似于定义常量，方法，但它定义了一组方法(包括构造器<br>make-person, get方法person-name, person-age(可以看到racket中的-号类似于java中的.号)，<br>对象的equal方法person?), 与此同时还有对于structure的计算规则(类似cond语句的计算规则)，<br>如(person-name (make-person “wtt” 29)) == “wtt”.</p>
<p>注: 我还在想为什么racket的对象没有set方法，后来看到tock方法的返回对象时才意识到，函数式<br>编程中对象是不可变的！所以没有set方法，当需要进行修改时，使用make-XXX返回一个新对象<br>就可以了!</p>
<p>程序中使用structure作为数据定义时，由于racket的数据类型是动态的，所以对于同样的structure<br>定义可以使用不同的方式来使用它。如书中的ball例子:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(define-structure ball [location velocity])</span><br><span class="line">1. 在一维时，这样构造实例 (make-ball 10 -5) 可以代表如距离top 10px, -5px的速度向上运动</span><br><span class="line">   (通常left top most is original point)</span><br><span class="line">2. 在二维时，这样构造实例 (make-ball (make-posn 3 4) (make-velo -2 3)), 其中需要额外定义</span><br><span class="line">   (define velo [dx dy])。</span><br></pre></td></tr></table></figure></p>
<p>正是由于racket类型的动态性，使得ball的定义无法具体规定location, velocity的具体类型，所以<br>以上两种构造实例的方式都是正确的。这种自由度一方面让库函数真正变得抽象化，函数性或功能性<br>更强，另一方面程序员自己编程时应当坚持某一特定的定义方式，避免给自己挖坑。</p>
<p>当实例间进行嵌套时，即对象的属性是另一个对象，也称为复合对象时，这时与java的级联调用如<br>person.house.price不同的是，racket的获取方法是反过来的，可以理解为of结构，price of house<br>of person, 具体语法为(house-price (person-house p)).当层级较多时，可以利用定义方法进行<br>简化。</p>
<h3 id="design-with-structure"><a href="#design-with-structure" class="headerlink" title="design with structure"></a>design with structure</h3><p>由于racket的类型动态性，data definition给出了其中属性的具体类型。定义的structure扩展了已有<br>的数据世界集合，而data definition则是通过限定类型划出了其中一部分在程序中使用。<br>下面是使用structure进行方法设计的步骤。</p>
<ol>
<li><p>定义structure, 给出instance和example, 这里的data example主要用来给后面的function单元<br>测试作测试数据对象使用。<br>如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(define-struct r3 [x y z])</span><br><span class="line"> ; an R3 is a structure:</span><br><span class="line"> ; (make-r3 number number number)</span><br><span class="line"> </span><br><span class="line"> (define ex1 (make-r3 3 4 5))</span><br><span class="line"> (define ex2 (make-r3 -3 0 7))</span><br></pre></td></tr></table></figure>
</li>
<li><p>定义方法的签名，目的和模板, 如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">; r3-&gt;number</span><br><span class="line">; calculate the distance from r3 to the original point</span><br><span class="line">(define (dis r) (r3-x r))</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用前面的对象例子定义方法例子，如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(define (dis ex1) (r3-x ex1))</span><br><span class="line">(define (dis ex2) (r3-x ex2))</span><br></pre></td></tr></table></figure>
</li>
<li><p>将属性的get方法写入方法模板中。</p>
</li>
<li>编写代码实现方法。</li>
<li>进行测试。</li>
</ol>
<h3 id="使用vim和tmux搭建编写运行Racket环境"><a href="#使用vim和tmux搭建编写运行Racket环境" class="headerlink" title="使用vim和tmux搭建编写运行Racket环境"></a>使用vim和tmux搭建编写运行Racket环境</h3><p>学(玩)Racket有一段时间了，跟着教程写了不少习题程序，我通常是用vim写好后在drracket中运行，<br>这也没太大问题，就是Racket编写括号和括号跳转较麻烦(括号键现在按的很熟了shift+9, 不过<br>%号还是够呛…),就想到在网上搜索有没有用vim来写Racket的文章。果然找到了，而且意外找到了<br>SICP的LaTex精美排版电子书和H5网站，这书现在还没学习(看完HowToProgram可以看看)，看网页效果<br>非常精美，也算意外之福, 由此可见网上好的资源如果搜到了，还是有很多的。</p>
<p>vim环境安装，链接为<a href="https://crash.net.nz/posts/2014/08/configuring-vim-for-sicp/" target="_blank" rel="noopener">crash.net.nz</a></p>
<ol>
<li><p>在应用文章前，我先将%改为,a键，.vimrc中加入:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">noremap &lt;Leader&gt;a %</span><br><span class="line">vnoremap &lt;Leader&gt;a %</span><br><span class="line">   &quot; note that using split can swap 4 file totally, 2 files for each pane</span><br><span class="line">noremap &lt;Leader&gt;g &lt;C-^&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在命令中运行命令<code>racket -i -p neil/sicp -l xrepl</code>， neil/sicp是对SICP书进行支持的第三方<br>库，xrepl是Racket extended REPL模式。<br>2019-11-01 21:39:01 添加:<br>加载自己编写的模块程序后，可以同drracket一样在交互区执行命令查看相应结果的命令行为<br><code>racket -it self.rkt -l xrepl</code>, 进入后可以使用<code>,h</code>查看xrepl的相关命令，<code>,e</code>进入自己模块的<br>内部命令空间，这时就可以获取到对应的变量值了。<br>其中，通过,h可以看到使用命令,install!可以将xrepl设置为默认选项，其实就是将<br><code>(require xrepl)</code>写入~/.racketrc文件中。这样以上命令可以简化为<code>racket -it xxx.rkt</code>即可直接<br>使用xrepl.</p>
</li>
<li><p>安装tmux.<br><code>sudo apt install tmux</code>.<br>基本命令:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">; create session</span><br><span class="line">tmux new -s sessionName</span><br><span class="line"></span><br><span class="line">; list all sessions</span><br><span class="line">tmux ls </span><br><span class="line"></span><br><span class="line">; detach from session</span><br><span class="line">prefix + d</span><br><span class="line"></span><br><span class="line">; attach to tmux  </span><br><span class="line">tmux attach -t sessionName</span><br><span class="line"></span><br><span class="line">; windows operation</span><br><span class="line">p+c p+&amp; p+p/n/l p+w p+, p+f </span><br><span class="line"></span><br><span class="line">; panes operation</span><br><span class="line">p+&quot;/% p+x p+o p+ctrl+up/down p+alt+up/down </span><br><span class="line"></span><br><span class="line">; tmux kill server</span><br><span class="line">tmux kill-server</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>修改默认前缀快捷键ctrl+b为ctrl+a, 修改~/.tmux.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># remap prefix to Control + a</span><br><span class="line">set -g prefix C-a</span><br><span class="line">unbind C-b</span><br><span class="line">bind C-a send-prefix</span><br></pre></td></tr></table></figure></p>
<p>保存后即可，对于已有的session使用命令<code>tmux source-file ~/.tmux.conf</code>使配置生效。<br>注: 不应当修改为ctrl+a, 与全选冲突，弃用！</p>
<ol start="6">
<li>使用额外脚本对lisp文件进行格式化，下载scmindent.rkt.<br>.vimrc中配置<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">autocmd filetype lisp,scheme,art setlocal equalprg=scmindent.rkt</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>使用ggVG=即可。</p>
<ol start="7">
<li>安装vim插件<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Plugin &apos;tpope/vim-surround&apos;</span><br><span class="line">Plugin &apos;sjl/tslime.vim&apos;</span><br><span class="line">Plugin &apos;kien/rainbow_parentheses.vim&apos;</span><br><span class="line"></span><br><span class="line">&quot; tslime &#123;&#123;&#123;</span><br><span class="line">let g:tslime_ensure_trailing_newlines = 1</span><br><span class="line">let g:tslime_normal_mapping = &apos;&lt;leader&gt;m&apos;</span><br><span class="line">let g:tslime_visual_mapping = &apos;&lt;leader&gt;m&apos;</span><br><span class="line">let g:tslime_vars_mapping = &apos;&lt;leader&gt;M&apos;</span><br><span class="line">&quot; &#125;&#125;&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="在泛化-itemization-中使用对象-structure"><a href="#在泛化-itemization-中使用对象-structure" class="headerlink" title="在泛化(itemization)中使用对象(structure)"></a>在泛化(itemization)中使用对象(structure)</h3><p>当world中有多个独立的对象时，某些对象出现时机可能是动态的，如书中的坦克，UFO和导弹的例子，<br>这时的数据定义可以使用泛化来表示2个对象的世界和3个对象的世界状态。</p>
<p>泛化——这个东西很神奇，前面提到过，它就表示函数中的一个变量，其类型不受限制，使用时根据<br>具体的值具有不同的类型，如火箭倒计时发射程序中的number类型，string类型。这里将这些基本类型<br>替换为structure对象类型，实现了更高的控制，更明确的表示出itemization是一个万花筒，可以真正<br>变成任何自己需要的对象。</p>
<p>使用泛化结构设计方法的步骤:</p>
<ol>
<li>根据问题描述确定是否需要这种泛化的数据定义，即如果问题描述中有多个不同类型的对象信息(或者<br>不同类型信息间有局部不同)，这时候就需要使用泛化;</li>
</ol>
<p>如果需要将不同的信息组合起来就需要结构(即组合成对象)。需要记住的是，如果对象结构太复杂，<br>应当拆分成独立的小结构。</p>
<p>最后，列出几个数据的例子，一方面检查对象结构，另一方面为测试数据<br>作准备。</p>
<ol start="2">
<li><p>同前面的基本方法设计，写方法签名，方法目的，方法模板。 </p>
</li>
<li><p>写出方法的测试案例，对泛化中的每种情况写一个测试案例。</p>
</li>
<li><p>实现方法模板。这里涉及到泛化本身的处理和内部结构的处理。泛化同前面一样，每种情况对应cond<br>语句的一种情况，如果泛化使用了结构，每种情况中就需要使用到对应属性的get方法。</p>
</li>
</ol>
<p>这里容易犯的错误是，直接根据问题描述开始写内部属性的get方法(如书中的spaceWar程序，这里就<br>开始写place-image,因为前面画静态图时已经有写好的表达式了)，这里其实应当写一个方法模板来<br>处理这条具体的cond语句情况，<strong>这个方法模板根据问题描述提取出合理的操作步骤</strong>，如spaceWar<br>程序中需要将UFO,TANK这2个物体常量添加背景图片中，就可以相应设计出ufo-render, tank-render<br>方法将处理步骤抽象出来。</p>
<p>这样做的好处比直接写place-image的好处很明显，直接写place-image完成后明显可以看到render方法<br>中ufo,tank的渲染在aim和fire中重复处理了，这时再优化代码还是需要将类似ufo-render, tank-render<br>的方法提取出来。从这里也看出，方法实现时做好api设计是非常重要的，节省了后期很多代码优化的<br>工作。</p>
<p>注: 在使用函数式编程时，有个最简单的是有时需要顺序执行2条不同的语句，因为lisp中没有语句的<br>概念，所有命令都是表达式，所以它更多是一种包含的关系，后者将前者的计算结果作为计算因子，如<br>这里的render, ufo-render, tank-render的关系，这一点在编写函数式编程时应当注意。这种机制也<br>确定了程序运行过程中每一步程序的状态都是确定的。</p>
<ol start="5">
<li><p>确定好方法模板后，这一步才是真正实现具体的方法。实现过程中如果某些独立功能，可以使用<br>前面提到的wish-list功能。</p>
</li>
<li><p>测试</p>
</li>
</ol>
<p>书中给出了一个问题，以下2个表达式什么时候会得到相同的结果?<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(ufo-render ufo (tank-render tank bg))</span><br><span class="line">(tank-render tank (ufo-render ufo bg))</span><br></pre></td></tr></table></figure></p>
<p>这个问题一看就是数学问题，f(g(x)) = g(f(x)), 那么符合这个条件的f(x),g(x)满足什么条件呢？<br>可以肯定是某种对称性，经过网上搜索，quora上找到答案:原来是f(x),g(x)互为反函数(初高中的数学<br>知识早忘了…), 也可以理解为它们是按y=x这条直线对称的。如y=x^2和x=sqrt(x)就满足这样的条件，<br>f(g(x)) == g(f(x)) = x.从这里也可以看出如何求反函数(inverse function), 将x,y位置互换，再<br>对y进行求值即可…汗！</p>
<p>spaceWar程序总结:</p>
<ol>
<li><p>单个属性的structure,如(define-struct ufo [p])是没有必要的，单个属性的structure可以用<br>该属性类型直接取代。这里ufo即等同于posn类型，没有必要额外定义structure.<br>如后面的(posn-x (ufo-p (aim-ufo aim1)))完全可以直接写为(posn-x (aim-ufo aim1))。</p>
</li>
<li><p>对于包含不同数据类型(包括基本类型和structure)的泛化的数据定义，通过注释来说明它的取值范围<br>明显是没有约束力，容易被忽略和违反约定。所以我们可以对于这样的数据定义自定义一个predicate<br>方法来进行约束。如missileOrNot的泛化可以定义如下方法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(define (mis? m) (cond</span><br><span class="line">                   [(or (false? m) (posn? m)) #t]</span><br><span class="line">                   [else #f]</span><br><span class="line">                 ))</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>对mis进行处理时，可以加上该predicate判断，属于防御性编程的一部分，让程序更健壮, 同时在<br>开发中这样做利于在复杂的程序中定位到数据类型不匹配的问题。<br>在big-bang表达式中有一个check-with从句(类似on-tick)，它的参数即可以接受这样一个wordstate?<br>的predicate方法，使得程序在运行中类型出错能及时停止程序运行并给出提示的功能。这在某种程序<br>上其实弥补了world program无法分步调试的缺陷。</p>
<h2 id="任意多的数据"><a href="#任意多的数据" class="headerlink" title="任意多的数据"></a>任意多的数据</h2><p>第一章讲完了基本数据类型和结构(对象), 这一章开始讲集合。<br>因为对象的数量是对象的外部性质，不属于对象本身的属性，所以这就涉及到数据结构的问题。<br>Racket也正是通过上面的data definition(其实也可以翻译为数据结构)来实现的集合。<br>同java中的内置数组不同，Racket使用了递归定义(自引用)实现了list集合。</p>
<h3 id="自引用数据定义设计"><a href="#自引用数据定义设计" class="headerlink" title="自引用数据定义设计"></a>自引用数据定义设计</h3><ol>
<li><p>数据定义必须包含2个条件从句，一个是没有自引用的表达式，如list集合定义中的’().另一个则是<br>包含自引用的表达式。可以通过构造例子来验证数据定义是否定义正确。</p>
</li>
<li><p>设计方法步骤不变，方法签名，目的，模板。只需要关注方法的参数类型即可，无需关心具体实现<br>步骤。</p>
</li>
<li><p>造方法例子时需要多造几个应用了自引用条件从句的例子。</p>
</li>
<li><p>因为一个自引用的数据定义本质上还是泛型数据定义, 所以实现方法时仍然是根据泛型的实现步骤<br>来实现，如构造与泛型的条件对应的cond条件从句。其中，模板中的自引用位置应当与数据定义中的<br>自引用位置保持一致，图示中的箭头可以使用本方法的再次应用来体现。这样的方法自引用即为<br>递归，或自然递归。</p>
</li>
<li><p>实现方法时应从无递归的条件从句(或基础例子)开始，再实现递归从句。对于自然递归，使用时应当<br>假设本方法已经实现了相应的功能，这样就可以得到需要的递归处理。剩下的步骤就是如何将不同的<br>值连接起来，这里包括数据定义中属性的get方法和自然递归方法调用。如计算list列表中元素的个数<br>可以想到就是在(how-many (rest list))的基础上加1即可得到需要的当前list集合的元素个数。有时候<br>这样的关系比较复杂，可以利用书中建议的表格方法，将方法例子中单个值和需要的值进行比对猜测得到<br>之间的关系，随后验证该猜测适用于所有的list元素。必要时可以借助辅助方法或嵌套条件得到需要的<br>链接方法。</p>
</li>
<li><p>最后将所有方法的例子转变为测试案例(最好是一开始就写为测试案例)，并确保测试覆盖率。</p>
</li>
</ol>
<h3 id="以集合为单元进行操作"><a href="#以集合为单元进行操作" class="headerlink" title="以集合为单元进行操作"></a>以集合为单元进行操作</h3><p>以上模板只适用于list集合的直接操作，对于如需要求list集合所有元素平均值的非直接处理，可以<br>先以list集合为单位进行操作拆分后再使用以上模板处理，如平均值=元素和/元素个数，后两者都<br>可以直接使用自然递归处理。</p>
<h3 id="自然数"><a href="#自然数" class="headerlink" title="自然数"></a>自然数</h3><p>如果想要得到一个包含了n个重复元素e的list集合怎么处理？作为一个java程序员，第一反应就是写一个<br>循环，以n为计数器，每次向集合中添加元素e. racket作为函数式编程语言，目前没有看到提供循环<br>功能，更多是使用递归。书中通过解析自然数(这里的计数器)的本质——自然数自带递归属性。<br>这样精妙的利用递归代替循环实现了同样的功能。代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">; a N is one of</span><br><span class="line">; 0</span><br><span class="line">; (add1 N)</span><br><span class="line"></span><br><span class="line">; 这里add1类似于cons的使用方式</span><br><span class="line">(define a (add1 (add1 (add1 0))))</span><br><span class="line">(define b (add1 (add1 0)))</span><br><span class="line">(define c 0)</span><br><span class="line"></span><br><span class="line">; N string -&gt; list</span><br><span class="line">;  get a N&apos;s string list</span><br><span class="line">(define (replist n str) (cond</span><br><span class="line">                          [(zero? n) &apos;()]</span><br><span class="line">                          [(positive? n) (cons str (replist (sub1 n) str))]))</span><br><span class="line"></span><br><span class="line">(check-expect (replist a &quot;wtt&quot;) (cons &quot;wtt&quot; (cons &quot;wtt&quot; (cons &quot;wtt&quot; &apos;()))))</span><br><span class="line">(check-expect (replist b &quot;cll&quot;) (cons &quot;cll&quot; (cons &quot;cll&quot; &apos;())))</span><br><span class="line">(check-expect (replist c &quot;ss&quot;) &apos;())</span><br></pre></td></tr></table></figure></p>
<p>从这里自然数的定义也可以看出，这种自引用的机制确实实现了书中的章节题目”无限大的数据”。<br>本质上还是利用了递归的无限性从而得到无限大的数据集合。</p>
<p>注：racket中没有方法重载的概念，重复定义相同的方法名会报错。</p>
<h3 id="russian-doll"><a href="#russian-doll" class="headerlink" title="russian doll"></a>russian doll</h3><p>俄罗斯套娃的本质还是有自引用的对象，转换为java对象即为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class Rd &#123;</span><br><span class="line"> private String color;</span><br><span class="line"> private Rd doll;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="常用的list集合方法"><a href="#常用的list集合方法" class="headerlink" title="常用的list集合方法"></a>常用的list集合方法</h3><p>这里列举出BSL中已经封装好有用的list集合方法:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(empty? null)  // null is &apos;()</span><br><span class="line">(list 2 4 6)   // simplify the list&apos;s initial step</span><br><span class="line">(length (cons 2 (cons 3 (cons 4 &apos;()))))   // list size</span><br><span class="line">(member? 2 (cons 2 &apos;()))   // list contains </span><br><span class="line">(make-list 4 &quot;wtt&quot;)       // quickly make a list with same elements </span><br><span class="line">(reverse (list 1 2 3))   // reverse a list</span><br><span class="line">(append (list 2 3) (list 4 5)) // merge lists as arguments order</span><br></pre></td></tr></table></figure></p>
<h3 id="组合函数"><a href="#组合函数" class="headerlink" title="组合函数"></a>组合函数</h3><p>工具函数准则:</p>
<ol>
<li>对每一个任务定义一个方法，对每一个存在依赖的数量关系定义一个工具函数。</li>
<li>针对每一个数据定义定义一个方法模板，当一个数据定义引用到另外一个数据定义时，就使用一个<br>工具函数进行处理。</li>
</ol>
<p>在实际实现方法模板的过程中，有以下几种情况需要使用工具函数:</p>
<ol>
<li>如果值的组合需要用到特定领域的知识，如合成图片，会计，音乐或科学知识等，这时应使用工具<br>函数。</li>
<li>如果值的组合依赖某个条件，当该条件的逻辑处理过于复杂时，此时也应当使用工具函数。</li>
<li>如果值的组合需要处理一个自引用数据定义中的元素时，如一个列表或自然数时，应考虑使用工具<br>函数。</li>
<li>如果一切都失败了，可以考虑实现一个更加一般化的函数，将需要的函数作为特例来解决。</li>
</ol>
<p>总体来说，程序设计的关键在于维护”方法愿望清单”。在向清单添加方法前，应先检查所使用的编程<br>语言提供的类库中是否已提供需要的功能。</p>
<h3 id="递归的工具函数"><a href="#递归的工具函数" class="headerlink" title="递归的工具函数"></a>递归的工具函数</h3><p>经测试，对数列进行排序，由于list本身的自引用特性(first, rest方法的使用)，很容易就实现了<br>插入排序算法。</p>
<p>注： 经编写prefixes list练习题发现, list和cons的区别：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(cons (list &quot;a&quot;) (list &quot;b&quot;))  -&gt; &apos;((&quot;a&quot;) &quot;b&quot;)</span><br><span class="line">(list (list &quot;a&quot;) (list &quot;b&quot;))  -&gt; &apos;((&quot;a&quot;) (&quot;b&quot;))</span><br></pre></td></tr></table></figure></p>
<p>可以看到，使用cons时后面的”b”是以元素的形式直接链接到最终结果中，说明cons适合作为同级元素<br>连接; 而使用list时后面的”b”被括号包裹起来是作为一个list集合链接到结果中，它是一个整体单元。</p>
<p>而prefixes练习中，<code>(add-head (first ls) (prefixes (rest ls)))</code>递归部分明显其中的元素需要被<br>填充进来，它不能作为一个整体，所以它需要使用cons与前面的(list (first ls))进行链接。<br>即最终结果为<code>(cons  (list (first ls))  (add-head (first ls) (prefixes (rest ls))) )</code>.</p>
<p>### </p>
<p>### </p>
<p>##</p>
<p><hr><br><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="http://wutaotaospace.oss-cn-beijing.aliyuncs.com/image/20191013_1.jpg" class="full-image"></p>

      
    </div>

    
      


    

    
    
    

    

    
      
    
    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div></div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById(&quot;QR&quot;); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="http://wutaotaospace.oss-cn-beijing.aliyuncs.com/image/wechat.jpg" alt="吴涛涛 微信支付">
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="http://wutaotaospace.oss-cn-beijing.aliyuncs.com/image/alipay.jpg" alt="吴涛涛 支付宝">
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    
      <div>
        



  



<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>吴涛涛</li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    
    <a href="http://www.taoblog.cn/post/fff758e4/" title="HowToProgramNote">http://www.taoblog.cn/post/fff758e4/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li>
</ul>

      </div>
    
    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Method/" rel="tag"><i class="fa fa-tag"></i> Method</a>
          
            <a href="/tags/Racket/" rel="tag"><i class="fa fa-tag"></i> Racket</a>
          
            <a href="/tags/Lisp/" rel="tag"><i class="fa fa-tag"></i> Lisp</a>
          
        </div>
      

      
      
        <div class="post-widgets">
        
          <div class="wp_rating">
            <div id="wpac-rating"></div>
          </div>
        

        

        
        </div>
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/post/394717d4/" rel="next" title="CrackDownInterviewNote">
                <i class="fa fa-chevron-left"></i> CrackDownInterviewNote
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/post/ddfb64ab/" rel="prev" title="VimNote">
                VimNote <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <a href="/">
              <img class="site-author-image" itemprop="image" src="http://wutaotaospace.oss-cn-beijing.aliyuncs.com/image/maya.jpg" alt="吴涛涛">
                </a>
            
              <p class="site-author-name" itemprop="name">吴涛涛</p>
              <p class="site-description motion-element" itemprop="description">wutaotao personal blog</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">23</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">17</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">50</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/wutaotao2015" title="GitHub &rarr; https://github.com/wutaotao2015" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
            </div>
          

          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://hexo.io/zh-cn/docs/" title="https://hexo.io/zh-cn/docs/" rel="noopener" target="_blank">Hexo</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://theme-next.iissnan.com/getting-started.html" title="http://theme-next.iissnan.com/getting-started.html" rel="noopener" target="_blank">Next</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.lingblog.net/" title="http://www.lingblog.net/" rel="noopener" target="_blank">cllBlog</a>
                  </li>
                
              </ul>
            
            </div>
          

          
          
          <div id="days"></div>
<script>
function show_date_time(){
window.setTimeout("show_date_time()", 1000);
BirthDay=new Date("01/18/2019 23:48:05");
today=new Date();
timeold=(today.getTime()-BirthDay.getTime());
sectimeold=timeold/1000
secondsold=Math.floor(sectimeold);
msPerDay=24*60*60*1000
e_daysold=timeold/msPerDay
daysold=Math.floor(e_daysold);
e_hrsold=(e_daysold-daysold)*24;
hrsold=setzero(Math.floor(e_hrsold));
e_minsold=(e_hrsold-hrsold)*60;
minsold=setzero(Math.floor((e_hrsold-hrsold)*60));
seconds=setzero(Math.floor((e_minsold-minsold)*60));
document.getElementById('days').innerHTML="blog has been running<br/>"
+daysold+" d "+hrsold+" h "+minsold+" m "+seconds+" s";
}
function setzero(i){
if (i<10)
{i="0" + i};
return i;
}
show_date_time();
</script>

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#程序设计步骤"><span class="nav-number">1.</span> <span class="nav-text">程序设计步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#设计方法步骤"><span class="nav-number">1.1.</span> <span class="nav-text">设计方法步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设计世界程序步骤"><span class="nav-number">1.2.</span> <span class="nav-text">设计世界程序步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#枚举，区间和泛化"><span class="nav-number">1.3.</span> <span class="nav-text">枚举，区间和泛化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#finite-states-worlds"><span class="nav-number">1.4.</span> <span class="nav-text">finite states worlds</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#adding-structure"><span class="nav-number">1.5.</span> <span class="nav-text">adding structure</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#design-with-structure"><span class="nav-number">1.6.</span> <span class="nav-text">design with structure</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用vim和tmux搭建编写运行Racket环境"><span class="nav-number">1.7.</span> <span class="nav-text">使用vim和tmux搭建编写运行Racket环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在泛化-itemization-中使用对象-structure"><span class="nav-number">1.8.</span> <span class="nav-text">在泛化(itemization)中使用对象(structure)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#任意多的数据"><span class="nav-number">2.</span> <span class="nav-text">任意多的数据</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#自引用数据定义设计"><span class="nav-number">2.1.</span> <span class="nav-text">自引用数据定义设计</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#以集合为单元进行操作"><span class="nav-number">2.2.</span> <span class="nav-text">以集合为单元进行操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自然数"><span class="nav-number">2.3.</span> <span class="nav-text">自然数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#russian-doll"><span class="nav-number">2.4.</span> <span class="nav-text">russian doll</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#常用的list集合方法"><span class="nav-number">2.5.</span> <span class="nav-text">常用的list集合方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#组合函数"><span class="nav-number">2.6.</span> <span class="nav-text">组合函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#递归的工具函数"><span class="nav-number">2.7.</span> <span class="nav-text">递归的工具函数</span></a></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2019 – <span itemprop="copyrightYear">2021</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">吴涛涛</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="站点总字数">501k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
    <span title="站点阅读时长">7:35</span>
  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.0.0</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="post-meta-divider">|</span>
  

  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="总访问量">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>







  




















  
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

  
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery_lazyload/1.9.7/jquery.lazyload.min.js"></script>

  
  <script src="//cdnjs.cloudflare.com/ajax/libs/velocity/1.2.1/velocity.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.ui.min.js"></script>


  


  <script src="/js/src/utils.js?v=7.0.0"></script>

  <script src="/js/src/motion.js?v=7.0.0"></script>



  
  


  <script src="/js/src/schemes/muse.js?v=7.0.0"></script>




  
  <script src="/js/src/scrollspy.js?v=7.0.0"></script>
<script src="/js/src/post-details.js?v=7.0.0"></script>



  


  <script src="/js/src/bootstrap.js?v=7.0.0"></script>



  
  

  

<script src="//cdn.jsdelivr.net/npm/leancloud-storage@3/dist/av-min.js"></script>



  

<script src="//cdnjs.cloudflare.com/ajax/libs/valine/1.3.4/Valine.min.js"></script>

<script>
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: '48ERsGJLrCK2gEVvR9razFEe-MdYXbMMI',
    appKey: 'mETL0o4bfizck0MCVvPOqv88',
    placeholder: 'Just go go',
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false
  });
</script>




  


  



  
  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.min.css">

  
  
    
  
  <script src="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.js"></script>
  

  <script src="/js/src/algolia-search.js?v=7.0.0"></script>



  
  
  <script>
    
    function addCount(Counter) {
      var $visitors = $('.leancloud_visitors');
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url }) })
        .done(function({ results }) {
          if (results.length > 0) {
            var counter = results[0];
            
            Counter('put', '/classes/Counter/' + counter.objectId, JSON.stringify({ time: { '__op': 'Increment', 'amount': 1 } }))
            
              .done(function() {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.time + 1);
              })
            
              .fail(function ({ responseJSON }) {
                console.log(`Failed to save Visitor num, with error message: ${responseJSON.error}`);
              })
          } else {
            
              Counter('post', '/classes/Counter', JSON.stringify({ title: title, url: url, time: 1 }))
                .done(function() {
                  var $element = $(document.getElementById(url));
                  $element.find('.leancloud-visitors-count').text(1);
                })
                .fail(function() {
                  console.log('Failed to create');
                });
            
          }
        })
        .fail(function ({ responseJSON }) {
          console.log(`LeanCloud Counter Error: ${responseJSON.code} ${responseJSON.error}`);
        });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + 'NCCFA0S02dv1PFmmODBJeCQO-gzGzoHsz')
        .done(function({ api_server }) {
          var Counter = function(method, url, data) {
            return $.ajax({
              method: method,
              url: 'https://' + api_server + '/1.1' + url,
              headers: {
                'X-LC-Id': 'NCCFA0S02dv1PFmmODBJeCQO-gzGzoHsz',
                'X-LC-Key': 'bAOsL8XKUXH3zST74CQcodSm',
                'Content-Type': 'application/json',
              },
              data: data
            });
          };
          
            addCount(Counter);
          
        });
    });
  </script>



  

  

  

  

  

  

  
  <script>
    wpac_init = window.wpac_init || [];
    wpac_init.push({
      widget: 'Rating',
      id: 16361,
      el: 'wpac-rating',
      color: 'fc6423'
    });
    (function() {
      if ('WIDGETPACK_LOADED' in window) return;
      WIDGETPACK_LOADED = true;
      var mc = document.createElement('script');
      mc.type = 'text/javascript';
      mc.async = true;
      mc.src = '//embed.widgetpack.com/widget.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(mc, s.nextSibling);
    })();
  </script>


  
  
  
    
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/pangu/3.3.0/pangu.min.js"></script>
  <script>pangu.spacingPage();</script>


  

  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  <script>
    $('.highlight').each(function(i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap');
      $(e).after($wrap);
      $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function(e) {
        var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
          return $(e).text();
        }).toArray().join('\n');
        var ta = document.createElement('textarea');
        var range = document.createRange(); //For Chrome
        var sel = window.getSelection(); //For Chrome
        var yPosition = window.pageYOffset || document.documentElement.scrollTop;
        ta.style.top = yPosition + 'px'; //Prevent page scroll
        ta.style.position = 'absolute';
        ta.style.opacity = '0';
        ta.value = code;
        ta.textContent = code; //For FireFox
        ta.contentEditable = true;
        ta.readOnly = false;
        document.body.appendChild(ta);
        range.selectNode(ta);
        sel.removeAllRanges();
        sel.addRange(range);
        ta.setSelectionRange(0, code.length);
        var result = document.execCommand('copy');
        
          if (result) $(this).text('复制成功');
          else $(this).text('复制失败');
        
        ta.blur(); //For iOS
        $(this).blur();
      })).on('mouseleave', function(e) {
        var $b = $(this).find('.copy-btn');
        setTimeout(function() {
          $b.text('复制');
        }, 300);
      }).append(e);
    })
  </script>


<script>!function(o){var i=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function c(t,e){var n=new Image,o=t.getAttribute("data-original");n.onload=function(){t.src=o,e&&e()},n.src=o}function n(){for(var t=0;t<i.length;t++)e=i[t],void 0,0<=(n=e.getBoundingClientRect()).top&&0<=n.left&&n.top<=(o.innerHeight||document.documentElement.clientHeight)&&c(i[t],function(){i.splice(t,t)});var e,n;console.log("trigger")}n(),o.addEventListener("scroll",function(){var t,e;t=n,e=o,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body>
</html>
